%&latex
\documentclass[a4paper]{article}

\usepackage[a4paper,margin=1.6in]{geometry}
\usepackage[affil-it]{authblk}
\usepackage{cite}
\usepackage[unicode]{hyperref}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{csquotes}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{enumerate}
\usepackage{commath}

\newcommand{\Co}[1]{}
\newcommand{\San}[1]{}
% operators that are separated from the operand by a space
\DeclareMathOperator{\Sgn}{sgn}
\DeclareMathOperator{\Supp}{supp}
\DeclareMathOperator{\Dom}{dom}
\DeclareMathOperator{\Sp}{span}
% autosize delimiters
\newcommand{\AP}[1]{\left(#1\right)}
\newcommand{\AB}[1]{\left[#1\right]}
\newcommand{\AC}[1]{\left\{#1\right\}}
\newcommand{\APM}[2]{\left(#1\;\middle\vert\;#2\right)}
\newcommand{\ABM}[2]{\left[#1\;\middle\vert\;#2\right]}
\newcommand{\ACM}[2]{\left\{#1\;\middle\vert\;#2\right\}}
% probability theory
\newcommand{\Pa}[2]{\underset{#1}{\operatorname{Pr}}\AB{#2}}
\newcommand{\CP}[3]{\underset{#1}{\operatorname{Pr}}\ABM{#2}{#3}}
\newcommand{\PP}[2]{\underset{\substack{#1 \\ #2}}{\operatorname{Pr}}}
\newcommand{\PPP}[3]{\underset{\substack{#1 \\ #2 \\ #3}}{\operatorname{Pr}}}
\newcommand{\E}[1]{\underset{#1}{\operatorname{E}}}
\newcommand{\Ea}[2]{\underset{#1}{\operatorname{E}}\AB{#2}}
\newcommand{\CE}[3]{\underset{#1}{\operatorname{E}}\ABM{#2}{#3}}
\newcommand{\EE}[2]{\underset{\substack{#1 \\ #2}}{\operatorname{E}}}
\newcommand{\EEE}[3]{\underset{\substack{#1 \\ #2 \\ #3}}{\operatorname{E}}}
\newcommand{\Var}[2]{\underset{#1}{\operatorname{Var}}\AB{#2}}
\newcommand{\I}[1]{\underset{#1}{\operatorname{I}}}
\newcommand{\CI}[3]{\underset{#1}{\operatorname{I}}\ABM{#2}{#3}}
\newcommand{\Ia}[2]{\underset{#1}{\operatorname{I}}\AB{#2}}
\newcommand{\II}[2]{\underset{\substack{#1 \\ #2}}{\operatorname{I}}}
\newcommand{\III}[3]{\underset{\substack{#1 \\ #2 \\ #3}}{\operatorname{I}}}
\newcommand{\KL}[2]{\operatorname{D}_{\mathrm{KL}}\AP{#1\middle\vert\middle\vert#2}}
\newcommand{\RD}[3]{\operatorname{D}_{#1}\AP{#2\middle\vert\middle\vert#3}}
\newcommand{\Dtv}{\operatorname{d}_{\text{tv}}}
\newcommand{\Dtva}[1]{\operatorname{d}_{\text{tv}}\AP{#1}}
\newcommand{\En}{\operatorname{H}}
\newcommand{\Ena}[1]{\operatorname{H}\AP{#1}}
% power set
\newcommand{\PS}[1]{\mathcal{P}\AP{#1}}
% differential
\newcommand{\D}{\mathrm{d}}
% arg
\newcommand{\Argmin}[1]{\underset{#1}{\operatorname{arg\,min}}\,}
\newcommand{\Argmax}[1]{\underset{#1}{\operatorname{arg\,max}}\,}
% numbers
\newcommand{\Nats}{\mathbb{N}}
\newcommand{\Ints}{\mathbb{Z}}
\newcommand{\Rats}{\mathbb{Q}}
\newcommand{\Reals}{\mathbb{R}}
\newcommand{\Coms}{\mathbb{C}}
% linear algebra
\newcommand{\Id}{\mathrm{I}}
\newcommand{\PD}{\mathrm{PD}}
\newcommand{\PSD}{\mathrm{PSD}}
\newcommand{\Hom}{\mathrm{Hom}}
\newcommand{\End}{\mathrm{End}}
\DeclareMathOperator{\Img}{im}
% topology and category theory
\newcommand{\Mor}{\mathrm{Mor}}
\newcommand{\Pt}{\boldsymbol{\mathrm{pt}}}
% empty string
\newcommand{\Estr}{\boldsymbol{\lambda}}
% limits
\newcommand{\Lim}[1]{\lim_{#1 \rightarrow \infty}}
\newcommand{\LimInf}[1]{\liminf_{#1 \rightarrow \infty}}
\newcommand{\LimSup}[1]{\limsup_{#1 \rightarrow \infty}}
% more delimiters
\newcommand{\Abs}[1]{\left\vert #1 \right\vert}
\newcommand{\Norm}[1]{\left\Vert #1 \right\Vert}
\newcommand{\Floor}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\Ceil}[1]{\left\lceil #1 \right\rceil}
\newcommand{\Chev}[1]{\left\langle #1 \right\rangle}
\newcommand{\Quote}[1]{\left\ulcorner #1 \right\urcorner}
% arrows
\newcommand{\K}{\xrightarrow{\mathrm{k}}}
\newcommand{\PF}{\xrightarrow{\circ}}
% Paper specific
\newcommand{\St}{\mathcal{S}}
\newcommand{\A}{\mathcal{A}}
\newcommand{\AX}{\A\sqcup\{\bot\}}
\newcommand{\Ob}{\mathcal{O}}
\newcommand{\FH}{\AP{\A\times\Ob}^*}
\newcommand{\FHS}{\AP{\A\times\St}^*}
\newcommand{\R}{\mathcal{R}}
\newcommand{\T}{\mathcal{T}}
\newcommand{\Hy}{\mathcal{H}}
\newcommand{\ER}{\mathrm{E}}
\newcommand{\Con}{\boldsymbol{\mathrm{ConSet}}}
\DeclareMathOperator{\Cone}{Cone}
\newcommand{\Ht}{\mathrm{h}}
\newcommand{\In}{\mathcal{I}}
\newcommand{\IS}{\mathcal{IS}}
\newcommand{\Prj}{\mathrm{pr}}
\DeclareMathOperator{\RVO}{\dim_{RVO}}
\DeclareMathOperator{\MB}{\dim_{MB}}
\newcommand{\DRVO}{D_{\mathrm{RVO}}}
\newcommand{\DMB}{D_{\mathrm{MB}}}
\newcommand{\Est}{\mathrm{est}}
\newcommand{\PE}{\pi_\Est}
\newcommand{\N}{\mathrm{N}}
\newcommand{\V}{\mathrm{V}}
\newcommand{\Q}{\mathrm{Q}}
\newcommand{\EU}{\mathrm{EU}}
\newcommand{\Reg}{\mathrm{R}}
\newcommand{\PSR}{\text{PS}}
\newcommand{\LS}{\mathrm{LS}}
\newcommand{\CS}{\mathrm{CS}}
\newcommand{\W}{\mathrm{W}}
\newcommand{\AT}{\mathrm{A}}
\newcommand{\THy}{\mathrm{H}_*}
\newcommand{\SHy}{\mathrm{H}}
\newcommand{\Ev}{\mathcal{E}}
\newcommand{\De}{\Delta}
\newcommand{\CSE}{G}
\usepackage{color}

\begin{document}

\textbf{TLDR:}\Co{b} We define a variant of reinforcement learning in which the reward is not perceived directly, but can be estimated at any given moment by some (possibly costly) experiment. The reward function is no longer a function of the observation history, but a different object that we call "instrumental reward function". We give two definitions of instrumental reward function and prove their equivalence. We also derive a regret bound for this setting.

\begin{Huge}Background\end{Huge}

In "classical" reinforcement learning the agent perceives the reward signal on every round of its interaction with the environment, whether through a distinct input channel or through some given way to compute the reward from the interaction history so far. On the other hand, we can rather easily imagine agents that optimize properties of their environment that they do not directly perceive. For example, if Alice, who lives in Dominica, donates money to the Against Malaria Foundation in order to save someone in Africa, then the result is usually not visible to Alice at the time it occurs, if ever. Similarly, Clippy the paperclip maximizer doesn't always perceive all the paperclips in the universe. Moreover, we might want to design agents that, in order to estimate the reward, direct queries to humans (which is costly and cannot be done continuously non-stop).

Now, it is possible to define the perceived reward as the \textit{subjective expected value}\Co{i} of the "true" imperceptible reward (see the Results section for details). Although this transformation preserves expected utility, it does \textit{not} preserve Bayesian regret. Indeed, Bayesian regret is the difference between the expected utility attained by the agent and the expected utility attained by a "reference" agent that knows the true environment from the onset. However, after the transformation, the reference agent will behave as if it knows the observable dynamics of the true environment but still pretends not to know the true environment for the purpose of computing the reward. Therefore, regret analysis requires us to consider the imperceptible reward honestly. In fact, as we will see, certain assumptions about the imperceptible reward function are needed even to make the problem learnable at all. Finally, this transformation makes the reward function more complex and hence applying a "generic" reinforcement learning algorithm after the transformation (instead of exploiting the special form of the resulting reward function) might carry a significant computational complexity penalty.

\textbf{Related Work:}\Co{b} [De Blanc 2011]\San{(https://arxiv.org/abs/1105.3821)}\Co{s} studies so called "ontological crises". That is, de Blanc examines the problem of translating a reward function from one ontology into another. Here, we avoid this problem by considering reward functions that are automatically defined in *all* ontologies. That said, it might still be interesting to think about how to specify our type of reward function starting from a reward function that is only defined in one particular ontology. We will return to this in the Discussion section.

[Krueger et al 2016]\San{(https://pdfs.semanticscholar.org/a47f/52b25ce1e56a03876d9c0fd7c45e63270eb4.pdf)}\Co{s} consider a setting where querying the reward is instantaneous and has a fixed cost. This is a special case of our setting, but we allow a much more general type of query and cost. Also, Krueger et al don't derive any theoretical regret bound (but they do present some experimental results).

Finally, multi-armed bandits with partial monitoring are closely related, see for example [Bartok et al 2013]\San{(http://www.mit.edu/~rakhlin/papers/partial_monitoring.pdf)}\Co{s}. However, bandits by definition assume a stateless environment, and also our approach is rather different than what is usually studied in partial monitoring.

The literature study was very cursory and I will be glad to know about prior work I missed!

\begin{Huge}Results\end{Huge}

\begin{Large}Partially Observable MDPs with Imperceptible Rewards\end{Large}

Partially Observable Markov Decision Processes (POMDPs) serve as a natural starting point for thinking about imperceptible rewards. Indeed, it might seem like all we have to do is consider RL in a POMDP environment and let the reward to be a function of the (imperceptible) state. However, this setting is in general unlearnable even given assumptions that rule out traps.

A (finite) POMDP is defined by non-empty finite sets $\St$ (states), $\A$ (actions) and $\Ob$ (observations), the transition kernel $\T:\St\times\A\K\St\times\Ob$ and the reward function $\R:\St\rightarrow[0,1]$. As opposed to a "classical" POMDP, the value of $\R$ is assumed to be imperceptible. The perceptible setting is a special case of the imperceptible setting: we can always encode the reward into the observation.

To formulate a learning problem, we assume $\St$, $\A$ and $\Ob$ to be fixed and an initial state $s_0\in\St$ to be given, while $\T$ and $\R$ are unknown and belong to some hypothesis class $\Hy$:

$$\Hy\subseteq\AC{\St\times\A\K\St\times\Ob}\times\bigg\{\St\rightarrow[0,1]\bigg\}$$

Such a problem can be unlearnable even if $\R$ is known and there are no irreversible events that can happen:

\textbf{Example 1}\Co{b}

\textit{Suppose that $\St=\AC{s_0,s_-,s_+}$, $\A=\AC{a_-,a_+}$, $\Ob=\AC{\bot}$, $\R\AP{s_0}=\frac{1}{2}$, $\R\AP{s_-}=0, \R\AP{s_+}=1$ and $\Hy=\AC{\AP{\T_-,\R},\AP{\T_+,\R}}$ where for any $s\in\St$}\Co{i}

$$\T_-\APM{s_+,\bot}{s,a_-}=1$$
$$\T_-\APM{s_-,\bot}{s,a_+}=1$$ 
$$\T_+\APM{s_+,\bot}{s,a_+}=1$$
$$\T_+\APM{s_-,\bot}{s,a_-}=1$$ 

\textit{Since $\Abs{\Ob}=1$, there is no way to gain any information about which hypothesis is correct. Moreover, the optimal policies for the two hypotheses are different. Namely, for $\T_+$ we should always take action $a_+$ and for $\T_-$ we should always take action $a_-$.}\Co{i}

To formalize and illustrate the discussion in the Background section, suppose $\Hy$ is Borel and $\zeta\in\Delta\Hy$ is the prior. We can then define the "perceived effective reward" $\ER\R:\FH\rightarrow[0,1]$ by

$$\ER\R(ao):=\CE{\substack{(\T,\R)\sim\zeta\\\AP{s_{n+1},o'_n}\sim\T\AP{s_n,a_n}}}{\R\AP{s_{\Abs{h}}}}{o'=o}$$

It is then easy to see that the $\ER$ operator preserves expected utility: given any policy $\pi:\FH\K \A$ and $m\in\Nats$

$$\Ea{\substack{(\T,\R)\sim\zeta\\a_n\sim\pi\AP{ao_{:n}}\\\AP{s_{n+1},o_n}\sim\T\AP{s_n,a_n}}}{\ER\R\AP{ao_{:m}}}=\Ea{\substack{(\T,\R)\sim\zeta\\a_n\sim\pi\AP{ao_{:n}}\\\AP{s_{n+1},o_n}\sim\T\AP{s_n,a_n}}}{\R\AP{s_m}}$$

and therefore, for any geometric time discount parameter $\gamma\in[0,1)$

$$\Ea{\substack{(\T,\R)\sim\zeta\\a_n\sim\pi\AP{ao_{:n}}\\\AP{s_{n+1},o_n}\sim\T\AP{s_n,a_n}}}{\sum_{n=0}^\infty\gamma^n\ER\R\AP{ao_{:n}}}=\Ea{\substack{(\T,\R)\sim\zeta\\a_n\sim\pi\AP{ao_{:n}}\\\AP{s_{n+1},o_n}\sim\T\AP{s_n,a_n}}}{\sum_{n=0}^\infty\gamma^n\R\AP{s_n}}$$

On the other hand, Bayesian regret is not preserved since, in general

$$\Ea{(\T,\R)\sim\zeta}{\max_{\pi}\Ea{aos\sim\T\pi}{\sum_{n=0}^\infty\gamma^n\ER\R\AP{ao_{:n}}}}\ne\Ea{(\T,\R)\sim\zeta}{\max_{\pi}\Ea{aos\sim\T\pi}{\sum_{n=0}^\infty\gamma^n\R\AP{s_n}}}$$

Here $aos\sim\T\pi$ is shorthand notation for the same probability distribution as before.

Indeed, in Example 1 the LHS of the above is $\frac{1}{2}\cdot\frac{1}{1-\gamma}$ since $\ER\R\equiv\frac{1}{2}$, whereas the RHS is $\frac{1}{2}+\frac{\gamma}{1-\gamma}$.

The pathology of Example 1 comes about because reward is not only imperceptible but entirely \textit{unobservable}\Co{i}. That is, no experiment can produce any information about whether the reward on a given round $n > 0$ was 0 or 1. More specifically, the states $s_-$ and $s_+$ are assigned different rewards, but there is no observable difference between them. It is as if Alice would assign value, not to people in Africa (whose existence and well-being can be measured) but to some Flying Spaghetti Monster s.t. the world behaves exactly the same regardless of its existence or condition.

This observation suggests that, instead of assigning rewards to states which are just abstract labels in a model, we should assign rewards to states that are defined in terms of the observable consequences of the interaction of the agent with the environment. This leads us to the notion of "instrumental state", which we will now define formally.

\begin{Large}Instrumental States and Reward Functions\end{Large}

First, we introduce some technical definitions for notational convenience.

\textbf{Definition 1}

\textit{$\Con$ is the category whose objects are pairs $(V,C)$ where $V$ is a real vector space and $C$ is a convex subset of $V$, and whose morphisms are}\Co{i}

$$\Mor\AP{(V,C),(W,D)}:=$$
$$\ACM{f:C\rightarrow D}{\exists A \in \Hom(V,W),w\in W \forall v\in C: f(v)=Av+w}$$

We omit describing identity and composition of morphisms since they are obvious.

It is easy to see that $\Con$ has arbitrary limits. In particular, $\Con$ has a final object that we denote by $\Pt$ (the one point set), products ($(V,C)\times(W,D)\cong(V\oplus W,C\times D)$) and inverse limits of sequences. For any finite set $A$, $\AP{\Reals^A,\Delta A}$ is an object in $\Con$. Also, we will sometimes abuse notation by regarding $C$ as an object of $\Con$ instead of $(V,C)$ (i.e. making $V$ implicit).

\textbf{Definition 2}\Co{b}

\textit{The functor $\Cone:\Con\rightarrow\Con$ is defined by}\Co{i}

$$\Cone{(V,C)}:=\AP{V\oplus\Reals,\ACM{(\lambda v,\lambda)}{\lambda\in[0,1], v\in C}}$$
$$\AP{\Cone{f}}(\lambda v, \lambda):=\AP{\lambda f(v), \lambda}$$

\textbf{Definition 3}\Co{b}

\textit{For any $C\in\Con$, we define $\Ht_{C}:\Cone{C}\rightarrow[0,1]$ by}\Co{i}

$$\Ht_{C}(\lambda v, \lambda):=\lambda$$

Note that $\Ht$ is a natural transformation from $\Cone$ to the constant functor with value $[0,1]$.

Given $C\in\Con$ and $x\in \Cone C$ s.t. $x=(u,\lambda)$ for $\lambda > 0$, we denote $[x]:=\lambda^{-1}u\in C$.

Now, we are ready to define instrumental states. We fix the sets $\A$ and $\Ob$.

\textbf{Definition 4}\Co{b}

\textit{For any $n\in\Nats$, we define} $\IS_n\in\Con$, the space of $n$ time step instrumental states, \textit{recursively by}

$$\IS_0:=\Pt$$
$$\IS_{n+1}:=\prod_{a\in\A}\AP{\prod_{o\in\Ob}\Ht_{\IS_n}}^{-1}(\Delta\Ob)$$

Here, $\prod_{o\in\Ob}\Ht_{\IS_n}$ is a mapping from $\prod_{o\in\Ob}\Cone\IS_n$ to $[0,1]^\Ob$. The inverse image of a convex set (in this case $\Delta\Ob\subseteq[0,1]^\Ob$) under an affine mapping (in this case $\prod_{o\in\Ob}\Ht_{\IS_n}$) is also a convex set.

The semantics of Definition 4 is as follows. Any $\alpha\in\AP{\prod_{o\in\Ob}\Ht_{\IS_n}}^{-1}(\Delta\Ob)$ can be regarded as a pair consisting of some $\alpha'\in\Delta\Ob$ (the image of $\alpha$ under $\prod_{o\in\Ob}\Ht_{\IS_n}$) and a mapping $\alpha'':\Supp{\alpha'}\rightarrow\IS_n$ defined by $\alpha''(o):=\AB{\alpha_o}$. Given $\theta\in\IS_{n+1}$, $\theta_{a}'$ is the probability distribution over observations resulting from taking action $a$ in state $\theta$, whereas $\theta_{a}''(o)$ is the state resulting from taking action a in state $\theta$ conditional on observing $o$. This semantics can be made more formal as follows:

\Co{In the following, we will use the notation $\theta\mid a$ instead of $\theta_a$ and $\theta\mid ao$ instead of $\theta_{a1}(o)$.}

\textbf{Definition 5}\Co{b}

\textit{Given $\theta\in\IS_n$, we define $\Dom\theta\subseteq\FH$ recursively as follows:}

1. $\Estr\in\Dom\theta$

2. \textit{For all $h\in\FH$, $a\in\A$ and $o\in\Ob$: $aoh\in\Dom\theta$ iff $n>0$, $\Ht_{\IS_{n-1}}(\theta_{ao})>0$ and $h\in\Dom\AB{\theta_{ao}}$.}

\textbf{Definition 6}

\textit{Given $\theta\in\IS_n$, $h\in\Dom\theta$ and $a\in\A$, and assuming that $\Abs{h}<n$, we recursively define $\theta(ha)\in\Delta\Ob$ by}\Co{i}

1. For $h=\Estr$: $\theta( o\mid a):=\Ht_{\IS_{n-1}}(\theta_{ao})$.

2. For $h=bph'$ with some $b\in\A$, $p\in\Ob$ and $h'\in\FH$: $\theta(ha):=\AB{\theta_{bp}}(h'a)$.

The point of defining $\IS_n$ in this manner is that (i) different points in $\IS_n$ correspond to states that are truly not equivalent, i.e. can be empirically distinguished (statistically) and (ii) convex combinations of points in $\IS_n$ correspond precisely to probabilistic mixtures:

\textbf{Definition 7}\Co{b}

\textit{Given $\theta\in\IS_n$ and $\pi:\AP{\A\times\Ob}^{<n}\K\A$ (a policy), we define $\theta\pi\in\Delta\AP{\A\times\Ob}^n$ (probability distribution over histories resulting from following policy $\pi$ in state $\theta$) by}\Co{i}

$$\Pa{ao\sim\theta\pi}{a_m=b}=\Ea{ao\sim\theta\pi}{\pi\APM{b}{ao_{:m}}}$$
$$\Pa{ao\sim\theta\pi}{o_m=p}=\Ea{ao\sim\theta\pi}{\theta\APM{p}{ao_{:m}a_m}}$$

\textbf{Proposition 1}\Co{b}

TBD 

\textbf{Proposition 2}\Co{b}

TBD

$\IS_n$ is a bounded polytope but in general it is \textit{not} a simplex: we cannot regard it as just probability distributions over some set. For example, if $\Abs{\A}=\Abs{\Ob}=2$, then it's easy to see that $\IS_1$ is a square (one axis is the probability to get a given observation when taking one action, the other axis is the probability for the other action). On the other hand, if $\Abs{\A}=1$ then $\IS_n$ \textit{is}\Co{i} a simplex: it is canonically isomorphic to $\Delta\Ob^n$.

There are a natural morphisms $\Prj_n:\IS_{n+1}\rightarrow\IS_n$ whose semantics is forgetting about the behavior of the state at time step $n$:

\textbf{Definition 8}\Co{b}

\textit{We define $\Prj_n:\IS_{n+1}\rightarrow\IS_n$ for any $n\in\Nats$ recursively. $\Prj_0$ is the unique morphism from $\IS_1$ to $\IS_0\cong\Pt$. For any $n\in\Nats$, $\Prj_{n+1}$ is given by}\Co{i}

$$\Prj_{n+1}(\theta)_{ao}:=\AP{\Cone{\Prj_n}}\AP{\theta_{ao}}$$

We thereby get a sequence $\IS_0 \leftarrow \IS_1 \leftarrow \IS_2 \leftarrow \ldots$

\textbf{Definition 9}\Co{b}

\textit{We define}\Co{i} $\IS_\omega$, the space of (infinite time step) instrumental states \textit{by}\Co{i}

$$\IS_\omega:=\varprojlim_n \IS_n$$

\textit{We denote the canonical projections by}\Co{i} $\Prj^n:\IS_\omega\rightarrow\IS_n$.

Of course, $\IS_\omega$ can also be regarded as the space of all possible stochastic environments. Specifically, we have:

\textbf{Definition 10}\Co{b}

\textit{For any $\mu\in\IS_\omega$ we define $\Dom\mu\in\FH$ by}\Co{i}

$$\Dom\mu:=\bigcup_{n=0}^\infty \Dom\Prj^n\mu$$

\textbf{Definition 11}\Co{b}

\textit{Given $\mu\in\IS_\omega$, $h\in\Dom\theta$ and $a\in\A$, we define $\mu(ha)\in\Delta\Ob$ by}\Co{i}

$$\mu(ha):=\Prj^{\Abs{h}+1}\mu(ha)$$

For each $n\in\Nats$, $\IS_n$ is finite-dimensional and therefore has a natural topology. $\IS_\omega$ also becomes a topological space by equipping it with the inverse limit topology. Since the $\IS_n$ are closed and bounded they are compact, and therefore $\IS_\omega$ is also compact by Tychonoff's theorem. In the special case $\Abs{\A}=1$, $\IS_\omega\cong\Delta\Ob^\omega$ and the inverse limit topology is the weak topology for probability measures, defined w.r.t. the product topology on $\Ob^\omega$.

We can now give the first definition of an instrumental reward function: a continuous affine function $\R: \IS_\omega \rightarrow \Reals$. Why affine? A convex linear combination of instrumental states is empirically indistinguishable from a probabilistic lottery. If we assign expected values to probabilistic lotteries (as we should by the VNM theorem), then we must also assign them to convex linear combinations of instrumental states: otherwise our reward again depends on entirely unobservable parameters of our model.

An alternative approach is to consider the notion of "experiment" explicitly.

We will use the notation $\mathcal{X}^{\leq\omega}:=\mathcal{X}^*\sqcup\mathcal{X}^\omega$. Given a logical condition $\phi$, the symbol $\boldsymbol{1}_\phi$ will denote 1 when $\phi$ is true and 0 when $\phi$ is false.

\textbf{Definition 12}\Co{b}

\textit{Given $\pi: \FH\K\AX$ and $\mu\in\IS_\omega$, we define $\mu\pi\in\Delta\AP{\A\times\Ob}^{\leq\omega}$ by}\Co{i}

$$\Pa{ao\sim\mu\pi}{a_n=b}=\Ea{ao\sim\mu\pi}{\boldsymbol{1}_{\Abs{ao}\geq n}\pi\APM{b}{ao_{:n}}}$$
$$\Pa{ao\sim\mu\pi}{o_n=p}=\Ea{ao\sim\mu\pi}{\boldsymbol{1}_{\Abs{ao}> n}\mu\APM{p}{ao_{:n}a_n}}$$

\textit{$\pi$ is said to be a}\Co{i} terminable policy \textit{when for any $\mu\in\IS_\omega$}\Co{i}

$$\Pa{h\sim\mu\pi}{\Abs{h}<\infty} = 1$$

That is, a terminable policy is allowed to produce a special token $\bot$ which terminates the "experiment" (instead of choosing an action), and we require that, for any environment, this token will be eventually produced with probability 1.

\textbf{Definition 13}\Co{b}

\textit{Given a terminable policy $\pi$ and a bounded function $r:\FH\rightarrow\Reals$, we define the function $\R_{\pi r}:\IS_\omega\rightarrow\Reals$ by
}\Co{i}
$$\R_{\pi r}(\mu):=\Ea{h\sim\mu\pi}{r(h)}$$

This gives us a second definition of instrumental reward functions. In fact, the two definitions are equivalent:

\textbf{Theorem 1}\Co{b}

\textit{For any terminable policy $\pi$ and bounded function $r:\FH\rightarrow\Reals$, $\R_{\pi r}$ is continuous and affine. Conversely, for any continuous affine $\R:\IS_\omega\rightarrow\Reals$, there exists a terminable policy $\pi$ and $r:\FH\rightarrow\Reals$ s.t. $\R = \R_{\pi r}$, $\sup r \leq \max\R$ and $\inf r \geq \min\R$.}\Co{i}

Putting the second part of the theorem into words, for any instrumental reward function (in the sense of the first definition) there is some experiment the agent can do which yields an \textit{unbiased estimate}\Co{i} of the reward for the instrumental state that existed at the beginning of the experiment.

To illustrate this concept of instrumental reward function, imagine that Clippy has access to a black box with a collection of levers on its outside. Pulling the levers produces some sounds that hint at what happens inside the box, but are not enough to determine it with certainty. The box has a shuttered glass window, whose shutter can be opened from the outside. Through the window, Clippy can see a jumble of scrap metal, mechanical manipulators that are controlled by the levers (and can be used to shape the scrap metal), and also a few mice running around the box and wreaking havoc. However, it is not possible to control the manipulators while the shutter is open. Worse, while opening the shutter allows seeing a snapshot of the shape of the metal, it also causes the manipulators to move chaotically, ruining this shape. So, Clippy can experiment with the levers and occasionally open the shutter to test the result. However, in order to produce and maintain paperclips inside the box, the shutter has to be kept closed (and the paperclips hidden) most of the time.

It is also possible to consider reward functions of the more general form $\R:\FH\times\IS_\omega\rightarrow\Reals$, required to be continuous and affine in the second argument. Such a reward function depends both on the current (unknown) instrumental state of the environment and the observable history so far. By Theorem 1, such a reward can be equivalently described in terms of a family $\AC{\pi_h:\FH\rightarrow\AX}_{h\in\FH}$ of terminable policies and a family $\AC{r_h:\FH\rightarrow\Reals}_{h\in\FH}$ of bounded functions s.t. 

$$\R(h,\mu)=\R_{\pi_h r_h}(\mu)$$

This means that, the value of reward can be estimated empirically, but only if the agent remembers the entire observation history. If the history is forgotten at some point, it might never be able to estimate the reward again. We will such reward functions "semi-instrumental".

In order to derive a regret bound, we will restrict attention to those reward functions for which the terminable policy can be made to terminate within time that has some finite and bounded expected value. I don't know an elegant way to characterize those reward functions in general, but we will describe one class of such functions.

\textbf{Definition 14}\Co{b}

\textit{Consider any $C\in\Con$. Then, we can define the} total variation distance $\Dtv:C\times C\rightarrow\Reals$ \textit{by}\Co{i}

$$\Dtv(x,y):=\sup_{r\in\Mor\AP{C,[0,1]}} \Abs{r(x)-r(y)}$$

In general, $\Dtv$ is a pseudometric. Moreover, when $C$ is finite-dimensional and bounded, it is a metrization of the natural topology. For a finite set $A$ and $C=\Delta A$, $\Dtv$ is just the usual total variation metric. For $C$ a ball of unit diameter in Euclidean space, $\Dtv$ is the Euclidean metric.

\textbf{Definition 15}\Co{b}

\textit{Consider any $\lambda\in(0,1)$. We define the metric} $\Dtv^\lambda$ \textit{on $\IS_\omega$ by}\Co{i}

$$\Dtv^\lambda(\mu,\nu):=\sup_{n\in\Nats}{\lambda^n\Dtv\AP{\Prj^n\mu,\Prj^n\nu}}$$

For any $\lambda$, $\Dtv^\lambda$ is a metrization of the inverse limit topology on $\IS_\omega$.

\textbf{Proposition 3}\Co{b}

\textit{Consider any $\lambda\in(0,1)$ and $\R:\IS_\omega\rightarrow\Reals$ affine and Lipschitz with respect to $\Dtv^\lambda$. Then there is a terminable policy $\pi$ and a bounded function $r:\FH\rightarrow\Reals$ s.t. $\R=\R_{\pi r}$ and}\Co{i}

$$\sup_{\mu\in\IS_\omega}\Ea{h\sim\mu\pi}{\Abs{h}} < \infty$$

Note that $\lambda$ is a parameter reminiscent of geometric time discount that constraints the shape of the reward function. However, in the regret analysis that follows, it is \textit{not}\Co{i} the same as the actual geometric time discount parameter $\gamma$. In particular, we consider the asymptotics in which the latter approaches 1, while the reward function is assumed to be fixed. It might be interesting to study regimes in which both approach 1, but we will not attempt it at present.

\begin{Large}A Regret Bound for RL with Instrumental Rewards\end{Large}

Fix $\A$ and $\Ob$. For any finite set $\St$ and $\T:\St\times\A\K\St\times\Ob$, there is a unique mapping $\In_\T:\St\rightarrow\IS_{\omega}$ s.t. 

$$\In_\T(s)_{ao}=\AP{\sum_{s'\in\St}\T\APM{s',o}{s,a}\In_T\AP{s'},\sum_{s'\in\St}\T\APM{s',o}{s,a}}$$

That is, $\In_\T(s)$ is just the instrumental state corresponding to the POMDP state $s$.

Given $\R:\IS_\omega\rightarrow\Reals$ continuous affine, we get for any $\St$ and $\T$ the POMDP reward function $\R\circ\In_\T$. Hence, one natural setting for regret analysis is fixing $\R$ and $\St$ and considering a hypothesis class of transition kernels

$$\Hy\subseteq\AC{\St\times\A\K\St\times\Ob}$$

However, regret analysis for POMDPs involves some technical complexity, and we prefer to start with a simpler setting. Hopefully, we will address the POMDP case in a followup essay.

Suppose that $\Ob=\St$. Then, given any MPD transition kernel $\T:\St\times\A\K\St$, we can define the POMDP transition kernel $\T^\sharp:\St\times\A\K\St\times\Ob$ by

$$\T^\sharp\APM{s',s''}{s,a}:=\boldsymbol{1}_{s'=s''}\T\APM{s'}{s,a}$$

Fix $\R:\St\times\IS_\omega\rightarrow[0,1]$ continuous affine in the second argument (a type of semi-instrumental reward function). For any $\T$ as above, we get the induced reward function $\R_\T:\St\rightarrow[0,1]$ given by $\R_\T(s):=\R\AP{s,\In_{\T^\sharp}(s)}$. We can now consider the learning problem corresponding to a hypothesis class of MDP transition kernels

$$\Hy\subseteq\AC{\St\times\A\K\St}$$

It might seem odd to consider a setting with fully observable states in the context of imperceptible rewards. However, we can think about it as follows: what we observe is only a label whose physical meaning is unknown. Only given the (unknown) transition kernel, such a label can be interpreted as assigned a reward.

For example, imagine a robot tasked with sorting balls into bins according to their weight. Some of the balls are solid gold and some of them are solid silver, so it's in principle possible to know their weight just by looking at them. However, the robot doesn't know a priori whether silver or gold is heavier. On the other hand, the robot can perform some experiment with a ball to determine its weight. In this situation, the reward is imperceptible even if the state (e.g. the locations, colors and sizes of the balls, the locations and shapes of the bins and the location of the robot and the state of its manipulators) is fully observable.

Using the concepts of MB dimension and RVO dimension we defined in a [previous essay]\San{(https://www.alignmentforum.org/posts/Qa5jG9z9dC6E4s9JH/dimensional-regret-without-resets)}, we can formulate the regret bound.

\textbf{Theorem 2}\Co{b}

\textit{There is some $C\in\Reals^+$ s.t. the following holds.}\Co{i}

\textit{Consider any finite non-empty sets $\St$ and $\A$, function continuous affine in the second argument $\R:\St\times\IS_\omega\rightarrow[0,1]$, closed set $\Hy\subseteq\AC{\St\times\A\K\St}$ and Borel probability measure $\zeta$ on $\Hy$ (prior). Suppose $\PE:\St\times\FHS\K\AX$ is s.t. for any $s\in\St$, $\PE(s,\cdot)$ is terminable, and $r:\St\times\FHS\rightarrow[0,1]$ is a bounded function s.t.}\Co{i}

$$\R(s,\cdot)=\R_{\pi_{\mathrm{est}}(s,\cdot)r(s,\cdot)}$$ 

\textit{Define the maximal expected reward estimation time $t_\Est$ by}\Co{i}

$$t_\Est=\sup_{s\in\St,\mu\in\IS_\omega}\Ea{h\sim\mu\pi_{\mathrm{est}}(s,\cdot)}{\Abs{h}}$$

\textit{Define the maximal bias span $\tau$ by}\Co{i}

$$\tau:=\limsup_{\gamma\rightarrow1}{\max_{\T\in\Hy}\frac{\max_{s\in\St}\V_{\T\R_\T}(s,\gamma)-\min_{s\in\St}\V_{\T\R_\T}(s,\gamma)}{1-\gamma}}$$

\textit{Define $\Hy^\R\subseteq\AC{\St\rightarrow\Reals}$ by}\Co{i}

$$\Hy^\R:=\ACM{\R_\T}{T\in\Hy}$$

\textit{Denote $\DMB:=\MB{\Hy^\R}$ and $\DRVO:=\RVO{\Hy^\R}$. Define the Bayesian regret $\Reg(\gamma)$ by}

$$\Reg(\gamma):=\Ea{\T\sim\zeta}{\EU^*_{\T\R_\T}(\gamma)-\EU^{\pi^\dagger_\gamma}_{\T\R_\T}(\gamma)}$$

\textit{Then, there is a family of policies $\AC{\pi^\dagger_\gamma:\St^*\times\St\K\A}_{\gamma\in(0,1)}$ s.t.}\Co{i}

$$\limsup_{\gamma \rightarrow 1}\frac{\Reg(\gamma)}{\sqrt[3]{\AP{\tau+t_{\mathrm{est}}}\AP{\DMB+1}\DRVO(1-\gamma)\ln{\frac{1}{1-\gamma}}}}\leq C$$

\begin{Huge}Discussion\end{Huge}

\begin{Large}More on the Regret Bound\end{Large}

It might appear odd that the regret bound in Theorem 2 depends on the dimensions of the class of reward functions, but not on the dimensions on the class of transition kernels, like in the perceptible case. The reason for this is that we only give the asymptotic form. Asymptotically, the leading term is $O\AP{\sqrt[3]{\AP{1-\gamma}\ln{\frac{1}{1-\gamma}}}}$ and its coefficient depends only on those parameters that appear in Theorem 2. However, examining the proof reveals that there is also an $O\AP{\sqrt{\AP{1-\gamma}\ln{\frac{1}{1-\gamma}}}}$ term that has the same form as the regret bound in the perceptible case. For the sake of brevity and simplicity we will \textit{not}\Co{i} attempt to write down a more precise regret bound that reflects the role of the dimensions of the class of transition kernels, but in principle it is not difficult. We must keep in mind, however, that in practice the other term might be significant: \textit{a priori}\Co{i} the dimensions of the class of transition kernels are only bounded by a polynomial in $\Abs{\St}$ and $\Abs{\A}$ and the latter might be exponentially big for realistic models. 

In fact, for the MDP setting we examine, the bound we give can probably be substantially improved. This is because we exploit the ability to measure an estimate of the reward, but we don't exploit the fact that knowing the transition kernel would make the reward effectively perceptible. For example, our ball sorting robot could measure the density of gold and silver once and consider it known thereafter (it's slightly worse if the measurement involves error, but not by that much). However, we mostly consider Theorem 2 to be a warm-up towards the POMDP setting, in which the reward never becomes effectively perceptible. In that setting, we suspect that $O\AP{\sqrt[3]{1-\gamma}}$ might be the best possible $\gamma$ dependence, up to logarithmic factors.

\begin{Large}The Death of the Agent and Kamikaze Strategies\end{Large}

There is one potential application of defining rewards that are not a direct function of observations which seems not supported by instrumental rewards as we defined them. Namely, one can imagine agents that are motivated to follow a certain strategy that is designed to \textit{destroy the agent}\Co{i} but produce some desirable results in the external world ("kamikaze policy"). In other words, although survival is a convergent instrumental goal, it seems entirely reasonable for it to be sacrificed in certain specific scenarios. To give an example, imagine a bodyguard robot whose primary goal is keeping a certain person alive. If assassins shoot at the person, and the only wait to stop them is for the robot to block the bullets with its body, then it can be the optimal strategy, even if it will destroy the robot and prevent it from continuing its function as bodyguard (assuming that e.g. it will give the person a chance to escape or someone else a chance to stop the assassins).

Our formalism doesn't directly address the possibility of the agent's death, because the sequence of actions and observations is assumed to be infinite. One simple way to accommodate death is postulating a special observation $\bot\in\Ob$ s.t. it is never received before death and always received after death. If we do this, then death corresponds to a specific instrumental state and therefore its reward is a fixed constant. This seems incompatible with kamikaze strategies where the decision of self-sacrifice is contingent on conditions in the external world after death. 

Another approach is assuming the agent becomes a "ghost": it keeps receiving observations which reflect the actual physical world but its actions have no effect. Such ghosts might theoretically be produced by a simplicity prior: for example, if the agent is an AI connected to a camera that monitors a room, then we can imagine a virtual video of the same room continuing beyond the AI's shutdown. This allows for different instrumental states after death and can potentially justify kamikaze strategies, but it seems like a very fragile construct and is unlikely to guarantee reasonable behavior.

The problem with death can be viewed from another perspective: our regret analysis assumes a no-traps condition ($\tau<\infty$) whereas death is usually a trap. Therefore, to guarantee rational behavior while accounting for death, we need to operate within a framework that allows for traps. 

One such framework is requiring Bayes-optimality and giving up on learnability. This seems both too weak (because nothing is guaranteed for specific environments) and too strong (because it's [computationally intractable]\San{(https://cstheory.stackexchange.com/questions/41396/is-bayes-optimal-rl-of-a-finite-set-of-dfas-feasible)}). That said, I think this approach can be salvaged by requiring something somewhat weaker than Bayes-optimality and proving something somewhat weaker than learnability (hopefully I will write on that in a future essay). In any case, once we give up on learnability we can allow unobservable rewards (the general POMDP setting in the beginning of the Results section) which allow handling death and kamikaze strategies easily. Specifically, we can have a plethora of "dead" states that produce only the $\bot$ observation and whose transitions do no depend on the action, but which have different rewards. So, this approach "solves" the problem but at a high cost: no learnability or regret analysis.

Another framework for dealing with traps is [Delegative Reinforcement Learning]\San{(https://www.lesswrong.com/posts/5bd75cc58225bf06703754d5/delegative-reinforcement-learning-with-a-merely-sane-advisor)} (DRL). In DRL the agent interacts with an external advisor, and is thereby able to successfully navigate all traps that the advisor knows about. In other words, it converges to a policy that is Bayes-optimal with respect to the belief state of the advisor (while the advisor is not able to produce such a policy by itself). Combining DRL with the instrumental rewards formalism should allow accounting for death. Specifically, in any given POMDP hypothesis, the state space will be decomposed as $\St=\St_{\text{dead}}\sqcup\St_{\text{alive}}$, with the following assumptions:

* The transition kernel on states in $\St_{\text{dead}}$ doesn't depend on the action.

* $\St_{\text{dead}}$ is invariant under the dynamics (death is irreversible).

* The reward function on $\St_{\text{dead}}$ can be arbitrary.

* The reward function on $\St_{\text{alive}}$ has to factor through $\In_\T$ (i.e. depend only on the instrumental state), and moreover the policy for estimating the reward function is known to be safe (alternatively, we might let the agent learn a safe estimation policy from some space of candidate policies).

Under these assumptions (or some variant thereof), it seems plausible that we should be able to prove learnability and derive a reasonable regret bound. Formalizing this line of thought is a task for future work.

The DRL approach to kamikaze strategies also has implications on corrigibility. Indeed, if the external advice is compatible with an admissible reward function that recommends shutting down the agent (i.e. upon delegation, the advisor acts to shut down the agent) then a DRL agent will assist with its own shutdown.
This property is preserved by subagents, since creating a subagent is another potentially irreversible action (and therefore must be [vetted]\San{(https://www.lesswrong.com/posts/5bd75cc58225bf0670375575/the-learning-theoretic-ai-alignment-research-agenda#5bd75cc58225bf0670375584)} by the advisor).

Also, it is tempting to speculate about DRL as a model of human self-sacrifice. We have already speculated before that we can view DRL as model of human learning, where the human's social environment or humanity as a whole is regarded as playing the role of the advisor. Similarly, humans that sacrifice their lives for the sake of their loved ones or the "greater good" can be regarded as heeding that "advise" regarding the rewards of states in which the human doesn't exist. Under this model, we can make sense of self-sacrifices by individual humans but not of hypothetical self-sacrifice by humanity as a whole (potentially augmented by other minds with which we could communicate and find common ground), but, the latter restriction seems compatible with intuition.

\begin{Large}Specifying Instrumental Reward Functions\end{Large}

It might be useful to find natural ways to specify instrumental reward functions. In particular, it is interesting to start with a reward function defined on a specific ontology (POMDP) and somehow extend it to a full instrumental reward function (which, like we said before, induces a reward function on any ontology via the $\In_\T$ mapping).

De Blanc suggests one way to extend reward functions from one POMDP to another, but I don't know whether this operation leads to an instrumental reward function, i.e. whether it is compatible with the constraints imposed by affine dependencies between the states (and I don't see any reason why it should).

Essentially, what we're looking for is a way to extend an affine function from an affine subspace to the entire affine space (the affine subspace is the affine span of the instrumental states corresponding to the states of the initial ontology; note that, if these instrumental states are not affine independent, then we have some constraint on this initial reward function). One natural way to do it is looking for an affine function whose differential (the linear function part) has minimal norm, or choosing some privileged projection operator from the entire space to the affine subspace. However, since the natural norms we have here are not inner product norms, these choices are usually non-unique, and it's possible we can't get much out of it.

A different natural approach is using Occam's razor, i.e. looking for an extension of minimal description length or the expected value of a random extension sampled from a conditional simplicity prior. This requires a natural way to describe instrumental reward functions. We do have such a way: assuming that the $\pi$ and $r$ guaranteed to exist by Theorem 1 can be chosen to be *computable*, the description is the program for those objects with respect to a fixed universal Turing machine (we consider a single program that computes both $\pi$ and $r$ to exploit possible mutual information between the two).

These questions are left for future research.

\begin{Huge}Proofs\end{Huge}

\textbf{Proposition A.1}\Co{b}

\textit{Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.}\Co{i}

$$A=\int_M{\left(B+CD^E-\sum_{n=0}^\infty\frac{X_n\left[Q^\gamma+R^{\int_0^1\boldsymbol{x}(t)\cdot A_n\left(v_n\otimes w_n\right) dt}\right]}{\alpha_n+\beta_n-\theta_n^\gamma F\left(B+\sin\phi\right)}\land\frac{\int_\mathcal{X}\rho_n}{\frac{df}{dx}\left(x_n\right)-v_n\mathrm{D}F}\right)}d\omega$$

\textbf{Proof of Proposition A.1}\Co{b}

Moo! $\blacksquare$

\end{document}


