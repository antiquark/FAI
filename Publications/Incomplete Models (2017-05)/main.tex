%
\documentclass[twoside,11pt]{article}

% Any additional packages needed should be included after jmlr2e.
% Note that jmlr2e.sty includes epsfig, amssymb, natbib and graphicx,
% and defines many common macros, such as 'proof' and 'example'.
%
% It also sets the bibliographystyle to plainnat; for more information on
% natbib citation styles, see the natbib documentation, a copy of which
% is archived at http://www.jmlr.org/format/natbib.pdf

\usepackage{jmlr2e}

%\usepackage[letterpaper,margin=1in]{geometry}
%\usepackage[affil-it]{authblk}
%\usepackage{cite}
\usepackage{hyperref}
%\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{csquotes}

%Fix amsmath conflict
\let\proof\relax
\let\endproof\relax
\usepackage{amsmath,amsthm}

\usepackage{enumerate}
\usepackage{commath}
\usepackage{bm}
\usepackage{chngcntr}
\usepackage{apptools}

% Definitions of handy macros can go here

\newcounter{Theorem}
\newtheorem{thm}{Theorem}
\newcounter{Lemma}
\newtheorem{lemm}{Lemma}
\newcounter{Definition}
\newtheorem{defn}{Definition}
\newcounter{Corollary}
\newtheorem{cor}{Corollary}
\newcounter{Proposition}
\newtheorem{prop}{Proposition}


%\numberwithin{equation}{section}

%\theoremstyle{definition}
%\newtheorem{definition}{Definition}%[section]
%\newtheorem{example}{Example}[section]

%\theoremstyle{plain}
%\newtheorem{theorem}{Theorem}%[section]
%\newtheorem{lemma}{Lemma}%[section]
%\newtheorem{proposition}{Proposition}%[section]
%\newtheorem{corollary}{Corollary}%[section]
%\newtheorem{conjecture}{Conjecture}[section]

%\theoremstyle{remark}
%\newtheorem{note}{Note}[section]

\AtAppendix{\counterwithin{thm}{section}}

%\newcommand{\Comment}[1]{}

\newcommand{\Nats}{\mathbb{N}}
\newcommand{\Ints}{\mathbb{Z}}
\newcommand{\Rats}{\mathbb{Q}}
\newcommand{\Reals}{\mathbb{R}}
\newcommand{\Coms}{\mathbb{C}}

\newcommand{\A}[1]{\lvert #1 \rvert}
\newcommand{\N}[1]{\lVert #1 \rVert}

\newcommand{\Argmin}[1]{\underset{#1}{\operatorname{arg\,min}}\,}
\newcommand{\Argmax}[1]{\underset{#1}{\operatorname{arg\,max}}\,}


\newcommand{\I}{\operatorname{id}}
\newcommand{\D}{\operatorname{diag}}

\newcommand{\Sq}[2]{\{#1\}_{#2 \in \Nats}}
\newcommand{\Sqn}[1]{\Sq{#1}{n}}

\newcommand{\B}{\operatorname{B}}

\DeclareMathOperator{\E}{E}
\newcommand{\EE}[2]{\operatorname{E}_{\substack{#1 \\ #2}}}
\newcommand{\EEE}[3]{\operatorname{E}_{\substack{#1 \\ #2 \\ #3}}}

\newcommand{\M}{\xrightarrow{\textnormal{k}}}


\newcommand{\PM}{\mathcal{P}}
\newcommand{\Lp}{{\operatorname{Lip}}}


\newcommand{\DTV}{\operatorname{d}_{\textnormal{TV}}}
\newcommand{\DKR}{\operatorname{d}_{\textnormal{KR}}}

\newcommand{\R}[1]{\N{#1}_{\text{R}}}

\newcommand{\Bd}{\Lambda}
\newcommand{\BM}{\bm{\mu}}
\newcommand{\CO}{C(\OO)}
\newcommand{\F}{\mathcal{F}}
\newcommand{\GC}{\mathfrak{G}}
\newcommand{\Gm}{\mathcal{B}}
\newcommand{\GMO}{\Gm(\OO)}
\newcommand{\MC}{\mathcal{H}}
\newcommand{\Ob}{\mathcal{O}}
\newcommand{\OO}{\Ob^\omega}
\newcommand{\PO}{\pi^\Ob}
\newcommand{\PMO}{\PM(\OO)}

\DeclareMathOperator{\V}{V}
\DeclareMathOperator{\SV}{\Sigma V}
\DeclareMathOperator{\SVM}{\Sigma V_{\min}}
\DeclareMathOperator{\SVX}{\Sigma V_{\max}}
\DeclareMathOperator{\Ab}{A}
\DeclareMathOperator{\Gr}{graph}
\DeclareMathOperator{\Nr}{N}
\DeclareMathOperator{\PG}{\Gamma}
\DeclareMathOperator{\Sp}{supp}







% Heading arguments are {volume}{year}{pages}{submitted}{published}{author-full-names}

\jmlrheading{X}{2017}{X-X}{6/02}{xx/xx}{ABCDE}{Vadim Kosoy} %Filled in by JMLR

% Short headings should be running head and authors last names

\ShortHeadings{Forecasting Using Incomplete Models}{Vadim Kosoy}
\firstpageno{1}

\begin{document}

\title{Forecasting Using Incomplete Models}

\author{\name Vadim Kosoy \\ 
        \email vadim.kosoy@intelligence.org \\
        %\addr Machine Intelligence Research Institute\\
        %2030 Addison Street, FL 7 \\
        %Berkeley, CA 94704, USA
       }

\editor{Editors Names Here} %Filled in by JMLR

\maketitle


%+Abstract
\begin{abstract}
We consider the task of forecasting an infinite sequence of future observation based on some number of past observations, where the probability measure generating the observations is \enquote{suspected} to satisfy one or more of a set of \emph{incomplete} models, i.e. convex sets in the space of probability measures. This setting is in some sense intermediate between the \emph{realizable} setting where the probability measure comes from some known set of probability measures (which can be addressed using e.g. Bayesian inference) and the \emph{unrealizable} setting where the probability measure is completely arbitrary. We demonstrate a method of forecasting which guarantees that, whenever the true probability measure satisfies an incomplete model in a given countable set, the forecast converges to the same incomplete model in the (appropriately normalized) Kantorovich-Rubinstein metric. This is analogous to merging of opinions for Bayesian inference, except that convergence in the Kantorovich-Rubinstein metric is weaker than convergence in total variation.
\end{abstract}
%-Abstract

\begin{keywords}
  forecasting, sequence prediction, online learning, unsupervised learning
\end{keywords}

\section{Introduction}

Forecasting future observations based on past observations is one of the fundamental problems in machine learning, and more broadly is one of the fundamental components of rational reasoning in general. This problem received much attention, using different methods (see e.g. \cite{Cesa-Bianchi_2006} or Chapter 21 in \cite{Shalev-Shwartz_2014}). Most of those methods assume fixing a class $\MC$ of models or \enquote{hypotheses}, each of which defines a probability measure on sequences of observations (and also conditional probability measures), and produce a forecast $F^\MC$ which satisfies at least one of two kinds of guarantees:

\begin{itemize}
\item 
In the \emph{realizable} setting, the guarantee is that if the observations are sampled from some $\mu \in \MC$, then $F^\MC$ converges to an \enquote{ideal} forecast in some sense.
\item
In the \emph{unrealizable} setting, the guarantee is that for \emph{any} sequence of observations, $F^\MC$ is asymptotically as good as the forecast produced by any $\mu \in \MC$.
\end{itemize}

The realizable setting is often unrealistic, in particular because it requires that the environment under observation is simpler than the observer itself. Indeed, even though we avoid analyzing computational complexity in this work, it should be noted that the computational (e.g. time) complexity of a forecaster is always greater than the complexities of all $\mu \in \MC$. On the other hand, the unrealizable setting usually only provides guarantees for short-term forecasts (since otherwise the training data is insufficient). The latter is in contrast to e.g. Bayesian inference where the time to learn the model depends on its prior probability, but once \enquote{learned} (i.e. once $F^\MC$ converged to a given total variation distance from the true probability measure), arbitrarily long-term forecasts become reliable.

The spirit of our approach is that the environment might be very complex, but at the same time it might posses some simple features, and it is these features that the forecast must capture. For example, if we consider a sequence of observations $\{o_n \in \{0,1\}\}_{n \in \Nats}$ s.t. $o_{2k+1}=o_{2k}$, then whatever is the behavior of the even observations $o_{2k}$, the property $o_{2k+1}=o_{2k}$ should asymptotically be assigned high probability by the forecast (this idea was discussed in \cite{Hutter_2009} as \enquote{open problem 4j}).

Formally, we introduce the notion of an \emph{incomplete model}, which is a convex set $M$ in the space $\PMO$ of probability measures on the space of sequences $\OO$. Such an incomplete model may be regarded as a hybrid of probabilistic and \emph{Knightian} uncertainty. We then consider a countable\footnote{This work only deals with the \emph{nonparametric} setting in which $\MC$ is discrete.} set $\MC$ of incomplete models. For any $M \in \MC$ and $\mu \in M$, our forecasts will converge to $M$ in an appropriate sense with $\mu$-probability 1. This convergence theorem can be regarded as an analogue for incomplete models of Bayesian merging of opinions (see \cite{Blackwell_1962}), and is our main result. Our setting can be considered to be in between realizable and unrealizable: it is \enquote{partially realizable} since we require the environment to conform to some $M \in \MC$, it is \enquote{partially unrealizable} since $\mu \in M$ can be chosen adversarially (we can even allow non-oblivious choice, i.e. dependence on the forecast itself).

\begin{sloppypar}
The forecasting method we demonstrate is based on the principles introduced in \cite{Garrabrant_2016}. The forecast may be regarded as the pricing of a certain combinatorial prediction market, with a countable set of gamblers making bets. The market pricing is then defined by the requirement that the aggregate of all gamblers doesn't make a net profit. The existence of such a pricing follows from the Kakutani-Glicksberg-Fan fixed point theorem and the Kuratowski-Rill-Nardzewski measurable selection theorem (the latter in order to show that the dependence on observation history can be made measurable). The fact that the aggregate of all gamblers cannot make a net profit implies that each individual gambler can only make a bounded profit.
\end{sloppypar}

The above method is fairly general, but for our purposes, we associate with each incomplete model $M \in \MC$ a set of gamblers that make bets which are guaranteed to be profitable assuming the true environment $\mu$ satisfies the incomplete model (i.e. $\mu \in M$). The existence of these gamblers follows from the Hahn-Banach separation theorem (where the incomplete model defines the convex set in question) and selection theorems used to ensure that the choice of separating functional depends in a sufficiently \enquote{regular} way on the market pricing. In order to show that the forecaster we described satisfies the desired convergence property, we use tools from martingale theory.

The structure of the paper is as follows. Section~\ref{sec:learning} defines the setting and states the main theorem. Section~\ref{sec:garrabrant} lays out the formalism of \enquote{combinatorial prediction markets,} and the central concept of a \emph{dominant forecaster}. Section~\ref{sec:prudent} introduces the concept of a \emph{prudent gambling strategy}, which is a technique for proving convergence theorems about dominant forecasters. Section~\ref{sec:construction} describes the gamblers associated with incomplete models and proves the main theorem.

\section{Learning Incomplete Models}
\label{sec:learning}

$\Nats$ will denote the set of natural numbers $\{0, 1, 2 \ldots\}$.

Let $\Sqn{\Ob_n}$ be a sequence of compact Polish spaces. $\Ob_n$ represents the space of possible observations at time $n$. Denote $\Ob^n := \prod_{m < n} \Ob_n$  and $\Ob^\omega:=\prod_{n \in \Nats} \Ob_n$. $\PO_n: \Ob^\omega \rightarrow \Ob^n$ is the projection mapping and $x_{:n}:=\PO_n(x)$. Given $y \in \Ob^n$, $y\OO := (\PO_n)^{-1}(y)$ is a closed subspace of $\OO$. $\Ob^n$ will be regarded as a topological space using the product topology and as a measurable space with the $\sigma$-algebra of \emph{universally measurable} sets\footnote{The fact we use universally measurable sets rather than Borel sets will play an important role in the proof of Lemma~\ref{lmm:savvy}.}. For any measurable space $X$, $\PM(X)$ will denote the space of probability measures on $X$. When $X$ is a Polish space with the Borel $\sigma$-algebra, $\PM(X)$ will be regarded as a topological space using the weak topology and as a measurable space using the $\sigma$-algebra of Borel sets. Given $\mu \in \PM(X)$, we denote $\Sp \mu \subseteq X$ the support of $\mu$.

%\begin{samepage}
\begin{defn}
A \emph{forecaster} $F$ is a family of measurable mappings

\[\Sqn{F_n: \Ob^n \rightarrow \PMO}\]

s.t. $\Sp {F_n(y)} \subseteq y\OO$.

\end{defn}
%\end{samepage}

Given a forecaster $F$ and $y \in \Ob^n$, $F_n(y)$ represents the forecast corresponding to observation history $y$. The condition $\Sp {F_n(y)} \subseteq y\OO$ reflects the obvious requirement of consistency with past observations.

In order to formulate a claim about forecast convergence, we will need a metric on $\PMO$. Consider $\rho: \OO \times \OO \rightarrow \Reals$ a metrization of $\OO$. Let $\Lp(\OO,\rho)$ be the Banach space of $\rho$-Lipschitz functions on $\OO$, equipped with the norm

\begin{equation*}
\N{f}_\rho:=\max_{x}{\A{f(x)}} + \sup_{x \ne y} \frac{\A{f(x)-f(y)}}{\rho(x,y)}
\end{equation*}

$\PMO$ can be regarded as a compact subset of the dual space $\Lp(\OO,\rho)'$, yielding the following metrization of $\PMO$:

\begin{equation*}
\DKR^\rho(\mu,\nu):=\sup_{\N{f}_\rho \leq 1}{(\E_\mu[f] - \E_\nu[f])}
\end{equation*}

We call $\DKR^\rho$ the \emph{Kantorovich-Rubinstein metric}\footnote{This is slightly different from the conventional definition but strongly equivalent. Other names used in the literature for the strongly equivalent metric are \enquote{1st Wassertein metric} and \enquote{earth mover's distance.}}.

Fix any $x \in \OO$. It is easy to see that

\begin{equation*}
\lim_{n \rightarrow \infty} \max_{x' \in x_{:n}\OO} \rho(x', x) = 0
\end{equation*}

Denote $\delta_x \in \PMO$ the unique probability measure s.t. $\delta_x(\{x\})=1$. It follows that for any sequence $\Sqn{\mu_n \in \PMO}$ s.t. $\Sp{\mu_n} \subseteq x_{:n}\OO$

\begin{equation*}
\lim_{n \rightarrow \infty} \DKR^\rho(\mu_n, \delta_x) = 0
\end{equation*}

Therefore, formulating a non-vacuous convergence theorem requires \enquote{renormalizing} $\DKR$ for each $n \in \Nats$. To this end, we consider a \emph{sequence} of metrizations of $\OO$: $\Sqn{\rho_n: \OO \times \OO \rightarrow \Reals}$. We denote $\DKR^n:=\DKR^{\rho_n}$.

Another ingredient we will need is a notion of regular conditional probability for incomplete models. For this purpose we will assume that for all $n \in \Nats$, $\Ob_n$ is a compact subset of $\Reals^{d_n}$ for some $d_n \in \Nats$, since this will allow us to use the Lebesgue differentiation theorem (in order to prove Lemma~\ref{lmm:update_incomplete}). In particular, $\Ob^n$ is a subset of $\Reals^{\sum_{m < n} d_n}$, and we will regard it as a metric space using the Euclidean metric. For any $y \in \Ob^n$ and $r > 0$, $\B_r(y)$ will denote the open ball of radius $r$ with center at $y$.

\begin{samepage}
\begin{defn}
\label{def:update_incomplete}

Consider any $M \subseteq \PMO$. For each $n \in \Nats$, we define $M \mid \Ob^n$ to be the minimal subset of $\Ob^n \times \PMO$ with the following properties:

\begin{enumerate}[i.]
\begin{sloppypar}
\item If $y \in \Ob^n$, $\mu \in \PMO$ and $\nu \in M$ are s.t. $y \in \Sp \PO_{n*}\nu$ and $\mu = \lim_{r \rightarrow 0}{(\nu \mid (\PO_n)^{-1}(\B_r(y)))}$, then $(y,\mu) \in M \mid \Ob^n$. Here, $\nu \mid (\PO_n)^{-1}(\B_r(y))$ is the conditional probability measure.
\end{sloppypar}
\item For each $y \in \Ob^n$, the set $M \mid y:=\{\mu \in \PMO \mid (y,\mu) \in M \mid \Ob^n\}$ is convex.
\item $M \mid \Ob^n$ is closed.

\end{enumerate}

It is easy to see that a minimal set with these properties always exists and is unique.

\end{defn}
\end{samepage}

We are now ready to formulate the main result.

Given a metric space $X$ with metric $\rho: X \times X \rightarrow \Reals$, $x \in X$ and $A \subseteq X$, we will use the notation

\begin{equation*}
\rho(x,A):=\inf_{y \in A} \rho(x,y)
\end{equation*}

\begin{thm}
\label{thm:main}

Fix any $\MC \subseteq 2^{\PMO}$ countable. Then, there exists a forecaster $F^\MC$ s.t. for any $M \in \MC$, $\mu \in M$ and $\mu$-almost any $x \in \OO$

\begin{equation}
\label{eqn:thm_main}
\lim_{n \rightarrow 0} \DKR^n(F^\MC_n(x_{:n}),\, M \mid x_{:n}) = 0
\end{equation}

\end{thm}

Note that $F^\MC$ as above exists for any choice of $\Sqn{\rho_n}$ but it depends on the choice. Informally, we can think of this choice as determining the duration of the future time period over which we need our forecast to be reliable.

\section{Dominant Forecasters}
\label{sec:garrabrant}

In this section we explain our generalization of the methods introduced in \cite{Garrabrant_2016} under the name \enquote{logical inductors.} The main differences between our formalism and that of \cite{Garrabrant_2016} are

\begin{itemize}
\item 
We are interested in sequence forecasting rather than formal logic.
\item
We consider probability measures on certain Polish spaces, rather than probability assignment functions on finite sets.
\item
In particular, no special treatment of expected values is required.
\item
The observations are stochastic rather than deterministic.
\end{itemize}

Our terminology also differs from \cite{Garrabrant_2016}: their \enquote{market} is our \enquote{forecaster}, their \enquote{trader} is our \enquote{gambler}. In any case, our exposition assumes no prior knowledge about logical inductors.

The idea is to consider a collection of gamblers making bets against the forecaster. If a gambler with finite budget cannot make an infinite profit, the gambler is said to be \enquote{dominated} by the forecaster. We then prove that for any countable collection of gamblers, there is a forecaster that dominates all of them.

Given a compact Polish space $X$, $C(X)$ will denote the Banach space of continuous functions with uniform norm. We will also use the shorthand notation $\Gm(X):=C(\PM(X) \times X)$. Equivalently, $\Gm(X)$ can be regarded to be the space of continuous functions from $\PM(X)$ to $C(X)$, and we will curry implicitly in our notation.

We regard $\GMO$ as the space of \emph{bets} that can be made against a forecaster. Given $\beta \in \GMO$, a forecast $\mu \in \PMO$ and observation sequence $x \in \OO$, the value of the bet $\beta$ is

\begin{equation*}
\V{\beta}(\mu,x):=\beta(\mu,x) - \E_{x' \sim \mu}[\beta(\mu,x')]
\end{equation*}

Note that this defines a bounded linear operator $\V: \Gm(X) \rightarrow \Gm(X)$.

$C(X)$ and $\Gm(X)$ will also be regarded as a measurable spaces, using the $\sigma$-algebra of Borel sets. We remind that the $\sigma$-algebra on $\Ob^n$ is the algebra of \emph{universally measurable} sets.

\begin{defn}

A \emph{gambler} is a family of measurable mappings

\[\Sqn{G_n : \Ob^n \times \PMO^n \rightarrow \Gm(\OO)}\]

\end{defn}

A gambler is considered to observe a forecaster and bet against it. Given $y \in \Ob^n$ and $\BM \in \PMO^n$, $G_n(y,\BM)=\beta$ means that, if $y$ are the first $n$ observations and $(\BM,\nu)$ are the first $n + 1$ forecasts (where $\nu$ is the forecast made after observing all of $y$), the gambler will make bet $\beta$.

We now introduce some notation regarding the interaction of gamblers and forecasters. 

Given a gambler $G$ and a forecaster $F$, we define the measurable mappings $G^F_n: \Ob^n \rightarrow \GMO$ by

\begin{equation}
\label{eqn:GF}
G^F_n(y):=G_n(y,F_0,F_1(y_{:1}) \ldots F_{n-1}(y_{:n-1}))
\end{equation}

Here, $y_{:m}$ denotes the projection of $y$ to $\Ob^m$.

We define the measurable mappings $\overline{\V G}^F_n: \Ob^n \rightarrow \CO$ and $\SV G^F_n: \Ob^{n-1} \rightarrow \CO$ by

\begin{equation*}
\overline{\V G}^F_n(y):=(\V G^F_n(y))(F_n(y))
\end{equation*}

\begin{equation*}
\SV G^F_n(y) := \sum_{m < n} \overline{\V G}^F_m(y_{:m})
\end{equation*}

In the definition of $\SV G^F_0$, $\Ob^{-1}$ is considered to be equal to $\Ob^0$ (i.e. the one point space).

We define the measurable mappings $\SVM G^F_n, \SVX G^F_n: \Ob^{n-1} \rightarrow \Reals$ by

\begin{equation*}
\SVM G^F_n(y):=\min_{y\OO} \SV G^F_n
\end{equation*}

\begin{equation*}
\SVX G^F_n(y):=\max_{y\OO} \SV G^F_n
\end{equation*}

We are now ready to state the formally state the definition of \enquote{dominance} alluded to in the beginning of the section.

\begin{defn}
\label{def:dominance}

Consider a forecaster $F$ and a gambler $G$. $F$ is said to \emph{dominate} $G$ when for any $x \in \OO$, if condition~\ref{eqn:def_dominance__loss} holds then condition~\ref{eqn:def_dominance__gain} holds:

\begin{equation}
\label{eqn:def_dominance__loss}
\inf_{n \in \Nats} {\SVM G^F_{n}(x_{:n-1})} > -\infty
\end{equation}

\begin{equation}
\label{eqn:def_dominance__gain}
\sup_{n \in \Nats} {\SVX G^F_{n}(x_{:n-1})} < +\infty
\end{equation}

\end{defn}

The following is the main theorem of this section, which is our analogue of Theorem 3.6.1 from \cite{Garrabrant_2016}.

\begin{thm}
\label{thm:exist_dominant}

Let $\Sq{G^k}{k}$ be a family of gamblers. Then, there exists a forecaster $F^G$ s.t. for any $k \in \Nats$, $F$ dominates $G^k$.

\end{thm}

The rest of the section is devoted to proving Theorem~\ref{thm:exist_dominant}. The proof will consist of two steps. First we show that for any \emph{single} gambler, there is a dominant forecaster. Then, given a countable set $\GC$ of gamblers, we construct a single gambler s.t. dominating this gambler implies dominating all gamblers in the set.

The following lemma shows that for any bet, there is a forecast which makes the bet unwinnable.

\begin{lemm}
\label{lmm:unwinnable}

Consider $X$ a compact Polish space and $\beta \in \Gm(X)$. Then, there exists $\mu \in \PM(X)$ s.t.

\begin{equation*}
\Sp \mu \subseteq \Argmax{} \beta(\mu)
\end{equation*}

\end{lemm}

\begin{proof}

Define ${K: \PM(X) \rightarrow 2^{\PM(X)}}$ as follows:

\[K(\mu):=\{\nu \in \PM(X) \mid \Sp{\nu} \subseteq \Argmax{}{\beta(\mu)}\}\]

For any ${\mu}$, ${K}(\mu)$ is obviously convex and non-empty. It is also easy to see that the graph of $K$ in $\PM(X) \times \PM(X)$ is closed. Applying the Kakutani-Glicksberg-Fan theorem, we conclude that $K$ has a fixed point, i.e. $\mu \in \PM(X)$ s.t. $\mu \in K(\mu)$.
\end{proof}

Next, we show that the probability measure of Lemma~\ref{lmm:unwinnable} can be made to depend measurably on past observations and the bet.

\begin{lemm}
\label{lmm:measurable_unwinnable}

Fix $Y_{1,2}$ compact Polish spaces and denote $X:=Y_1 \times Y_2$. Then, there exists a Borel measurable mapping $\alpha: Y_1 \times \Gm(X) \rightarrow \PM(X)$ s.t. for any $y \in Y_1$ and $\beta \in \Gm(X)$

\begin{equation*}
\Sp \alpha(y,\beta) \subseteq \Argmax{y \times Y_2} \beta(\alpha(y,\beta))
\end{equation*}

\end{lemm}

\begin{proof}

Define ${Z_1, Z_2, Z \subseteq Y_1 \times \Gm(X) \times \PM(X)}$ by

$${Z_1:=\{(y,\beta,\mu) \in Y_1 \times \Gm(X) \times \PM(X) \mid \Sp \mu \subseteq y \times Y_2\}}$$

$${Z_2:=\{(y,\beta,\mu) \in Y_1 \times \Gm(X) \times \PM(X) \mid \E_\mu[\beta(\mu)] = \max_{y_2 \in Y_2} \beta(\mu,y,y_2)\}}$$

$${Z:=Z_1 \cap Z_2 =\{(y,\beta,\mu) \in Y_1 \times \Gm(X) \times \PM(X) \mid \Sp \mu \subseteq \Argmax{y \times Y_2} \beta(\mu)\}}$$

We can view ${Z}$ as the graph of a \emph{multivalued} mapping from ${Y_1 \times \Gm(X)}$ to ${\PM(X)}$ (i.e a mapping from ${Y_1 \times \Gm(X)}$ to $2^{\PM(X)}$). We will now show that this multivalued mapping has a \emph{selection}, i.e. a single-valued Borel measurable mapping whose graph is a subset of $Z$. Obviously, the selection is the desired ${\alpha}$.

\begin{sloppypar}
Fix $\rho$ a metrization of $Y_1$. $Z_1$ is the vanishing locus of the continuous function $\E_{(y_1, y_2) \sim \mu}[\rho(y_1,y)]$. $Z_2$ is the vanishing locus of the continuous function $\E_\mu[\beta(\mu)] - \max_{y_2 \in Y_2} \beta(\mu,y,y_2)$. Therefore $Z_{1,2}$ are closed and so is $Z$. In particular, the fiber ${Z_{y\beta}}$ of ${Z}$ over any ${(y,\beta) \in Y_1 \times \Gm(X)}$ is also closed.
\end{sloppypar}

For any ${y \in Y_1}$, ${\beta \in \Gm(X)}$, define ${i_y: Y_2 \rightarrow X}$ by ${i_y(y_2):=(y,y_2)}$ and ${\beta_y \in \Gm(Y_{2})}$ by $\beta_y(\nu,y'):=\beta(i_{y*}\nu,y,y')$. Applying Lemma~\ref{lmm:unwinnable} to ${\beta_y}$ we get ${\nu \in \PM(Y_2)}$ s.t.

$$\Sp \nu \subseteq \Argmax{} \beta_y(\nu)$$

It follows that ${(y,\beta,i_{y*}\nu) \in Z}$ and hence ${Z_{y\beta}}$ is non-empty.

Consider any ${U \subseteq \PM(X)}$ open. Then, ${A_U:=(Y_{1} \times \Gm(X) \times U) \cap Z}$ is locally closed, and in particular, it is an ${F_\sigma}$ set. Therefore, the image of ${A_U}$ under the projection to ${Y_{1} \times \Gm(X)}$ is also ${F_\sigma}$ and in particular Borel. 

Applying the Kuratowski-Rill-Nardzewski measurable selection theorem, we get the desired result.
\end{proof}

We define the measurable mappings $\bar{G}^F_n: \Ob^n \rightarrow \CO$ by

\begin{equation*}
\bar{G}^F_n(y) := G^F_n(y;F_n(y))
\end{equation*}

\begin{cor}
\label{crl:dominate_one}

Let $G$ be a gambler. Then, there exists a forecaster $F$ s.t. for all $n \in \Nats$ and $y \in \Ob_n$

\begin{equation*}
\Sp F_n(y) \subseteq \Argmax{y\OO} \bar{G}^F_n
\end{equation*}

\end{cor}

\begin{proof}

For every $n \in \Nats$, let $\alpha_n: \Ob_n \times \GMO \rightarrow \PMO$ be as in Lemma~\ref{lmm:measurable_unwinnable}. Observing that the definition of $G^F_n$ depends only on $F_m$ for $m < n$, we define $F$ recursively as

\[F_n(y):=\alpha_n(y,G^F_n(y))\]
\end{proof}

In particular, the forecaster $F$ of Corollary~\ref{crl:dominate_one} dominates $G$ since, as easy to see, $\overline{\V G}^F_n \leq 0$ and hence $\SV G^F_n \leq 0$.

We will now introduce a way to transform a gambler in a way that enforces a \enquote{finite spending budget.} Consider a gambler $G$ and fix $b > 0$ (the size of the \enquote{budget}). Define the measurable functions $\SV G_n: \Ob^{n-1} \times \PMO^n  \rightarrow \CO$ by

\begin{equation*}
\SV G_n(y,\BM) := \sum_{m < n} (\V G_m(y_{:m},\BM_{:m}))(\BM_m)
\end{equation*}

Here, $\BM_{:m}$ denotes the projection of $\BM \in \PMO^n$ to $\PMO^m$ that takes components $l < m$ and $\BM_m$ denotes the $m$-th component of $\BM$. Define the measurable functions $\SVM G_n, \SVX G_n: \Ob^{n-1} \times \PMO^n  \rightarrow \Reals$ by

\begin{equation*}
\SVM G_n(y,\BM) := \min_{y\OO}{\SV G_n(y,\BM)}
\end{equation*}

\begin{equation*}
\SVX G_n(y,\BM) := \max_{y\OO}{\SV G_n(y,\BM)}
\end{equation*}

Define the measurable sets

\begin{equation*}
\Ab_b G_n:=\{(y,\BM) \in \Ob^{n-1} \times \PMO^n \mid \SVM G_n(y,\BM) > -b\}
\end{equation*}

Note that $\Ab_b G_n \times \Ob_n$ is a measurable subset of $\Ob^n \times \PMO^n$ and in particular can be regarded as a measurable space in itself. Define the measurable functions $\Nr_b G_n: \Ab_b G_n \times \Ob_n \rightarrow C(\PMO)$ by

\begin{equation*}
\Nr_b G_n(y,\BM;\nu):=\max(1,\max_{y\OO} \frac{-(\V G_n(y,\BM))(\nu)}{\SV G_n(y_{:n-1},\BM)+b})^{-1}
\end{equation*}

Finally, define the gambler $\Bd_b G$ as follows

\begin{equation*}
\Bd_b G_n(y,\BM):=\begin{cases} 0 \text{ if } \exists m < n: (y_{:m},\BM_{:m+1}) \not\in \Ab_b G_{m+1} \\ \Nr_b G_n(y,\BM) \cdot G_n(y, \BM) \text{ otherwise} \end{cases}
\end{equation*}

The next proposition shows that as long as $G$ stays \enquote{within budget $b$,} the operator $\Bd_b$ has no effect. 

\begin{prop}
\label{prp:b_no_effect}

Consider any gambler $G$, $b > 0$, $n \in \Nats$, $y \in \Ob^{n - 1}$ and $\BM \in \PMO^n$. Assume that for all $m < n$, $(y_{:m},\BM_{:m+1}) \in \Ab_b G_{m+1}$. Then, for all $m < n$

\begin{equation*}
\Bd_b G_m(y_{:m},\BM_{:m};\BM_m)=G_m(y_{:m},\BM_{:m};\BM_m)
\end{equation*}

\end{prop}

\begin{proof}

Consider any $m < n$. We have

$$\SVM G_{m+1}(y_{:m},\BM_{:m+1}) + b > 0$$

$$\forall x \in y_{:m}\OO: \SV G_{m+1}(y_{:m},\BM_{:m+1}; x) + b > 0$$

$$\forall x \in y_{:m}\OO: \SV G_{m}(y_{:m-1},\BM_{:m}; x) + (\V G_{m}(y_{:m},\BM_{:m}))(\BM_{m}, x) + b > 0$$

$$\forall x \in y_{:m}\OO: \SV G_{m}(y_{:m-1},\BM_{:m}; x) + b > -(\V G_{m}(y_{:m},\BM_{:m}))(\BM_{m}, x)$$

Using the assumption again, the left hand side is positive. It follows that

$$\forall x \in y_{:m}\OO: 1 > \frac{-(\V G_{m}(y_{:m},\BM_{:m}))(\BM_{m}, x)}{\SV G_{m}(y_{:m-1},\BM_{:m}; x) + b}$$

$$\Nr_b G_m(y_{:m},\BM_{:m};\BM_m) = 1$$

Since we are in the second case in the definition of ${\Bd_b G_m(y_{:m},\BM_{:m})}$, we get the desired result.
\end{proof}

Now, we show that $\Bd_b G$ indeed never \enquote{goes over budget.}

\begin{prop}
\label{prp:b_stays_in_budget}

Consider any gambler $G$ and $b > 0$. Then, for any $n \in \Nats$, $y \in \Ob^{n-1}$ and $\BM \in \PMO^n$

\begin{equation*}
\SVM \Bd_b G_n(y,\BM) \geq -b
\end{equation*} 

\end{prop}

\begin{proof}

Let ${m_0 \in \Nats}$ be the largest number s.t. ${m_0 \leq n}$ and 

$$\forall m \leq m_0: \SVM G_m(y_{:m-1},\BM_{:m}) > -b$$

For any ${m \leq m_0}$, we have, by Proposition~\ref{prp:b_no_effect}

$$\SVM \Bd_b G_m(y_{:m-1},\BM_{:m})=\SVM G_m(y_{:m-1},\BM_{:m}) > -b$$

(Note that the sum in the definition of ${\SVM \Bd_b G_m}$ only involves ${\Bd_b G_l}$ for ${l < m \leq m_0}$)

For ${m=m_0+1}$ and any $x \in y_{:m_0}\OO$, we have

\begin{multline*}
\SV \Bd_b G_{m_0+1}(y_{:m_0},\BM_{:m_0+1};x) = \SV \Bd_b G_{m_0}(y_{:m_0-1},\BM_{:m_0};x) + \\ (\V \Bd_b G_{m_0}(y_{:m_0},\BM_{:m_0}))(\BM_{m_0},x)
\end{multline*}

The first term only involves ${\Bd_b G_l}$ for ${l < m_0}$, allowing us to apply Proposition~\ref{prp:b_no_effect}. The second term is in the second case of the definition of $\Bd_b$.

\begin{align*}
\SV \Bd_b G_{m_0+1}(y_{:m_0},\BM_{:m_0+1};x) = &\SV G_{m_0}(y_{:m_0-1},\BM_{:m_0};x) +\\ &\Nr_b G_{m_0}(y_{:m_0},\BM_{:m_0};\BM_{m_0}) \cdot (\V G_{m_0}(y_{:m_0},\BM_{:m_0}))(\BM_{m_0},x)
\end{align*}

If ${x}$ is s.t. ${(\V G_{m_0}(y_{:m_0},\BM_{:m_0}))(\BM_{m_0},x) \geq 0}$, then

\[\SV \Bd_b G_{m_0+1}(y_{:m_0},\BM_{:m_0+1};x) \geq \SV G_{m_0}(y_{:m_0-1},\BM_{:m_0};x)\geq \SVM G_{m_0}(y_{:m_0-1},\BM_{:m_0}) > -b\]

If ${x}$ is s.t. ${(\V G_{m_0}(y_{:m_0},\BM_{:m_0}))(\BM_{m_0},x) < 0}$, then, by the definition of $\Nr_b$

\begin{multline*}
\SV \Bd_b G_{m_0+1}(y_{:m_0},\BM_{:m_0+1};x) \geq \SV G_{m_0}(y_{:m_0-1},\BM_{:m_0};x)+ \\
\frac{\SV G_{m_0}(y_{:m_0-1},\BM_{:m_0};x) + b}{-(\V G_{m_0}(y_{:m_0},\BM_{:m_0}))(\BM_{m_0},x)} \cdot (\V G_{m_0}(y_{:m_0},\BM_{:m_0}))(\BM_{m_0},x)
\end{multline*}

$$\SV \Bd_b G_{m_0+1}(y_{:m_0},\BM_{:m_0+1};x) \geq -b$$

Finally, consider ${m > m_0 + 1}$.

\begin{multline*}
\SV \Bd_b G_{m}(y_{:m-1},\BM_{:m};x) = \SV \Bd_b G_{m-1}(y_{:m-2},\BM_{:m-1};x) + \\ (\V \Bd_b G_{m-1}(y_{:m-1},\BM_{:m-1}))(\BM_{m-1},x)
\end{multline*}

The second term is in the first case of the definition of $\Bd_b$ and therefore vanishes.

$$\SV \Bd_b G_{m}(y_{:m-1},\BM_{:m};x) = \SV \Bd_b G_{m-1}(y_{:m-2},\BM_{:m-1};x)$$

By induction on ${m}$, we conclude:

$$\SVM \Bd_b G_{m}(y_{:m-1},\BM_{:m}) \geq \SVM \Bd_b G_{m-1}(y_{:m-2},\BM_{:m-1}) \geq -b$$
\end{proof}

Next, we show that for any gambler there is \enquote{limited budget} gambler s.t. any forecaster that dominates it also dominates the original gambler.

\begin{prop}
\label{prp:frugal_gambler}

Let $G$ be a gambler and $\zeta: \Nats \rightarrow (0,1]$ be s.t.

\begin{equation*}
b_\zeta := \sum_{b=0}^\infty \zeta(b) b < \infty
\end{equation*}

Define the gambler $\Bd_\zeta G$ by

\begin{equation*}
\Bd_\zeta G := \sum_{b = 1}^\infty \zeta(b) \Bd_b G
\end{equation*}

Then

\begin{equation}
\label{eqn:prp_furgal_gambler__svm_b_zeta}
\SVM \Bd_\zeta G_n \geq -b_\zeta
\end{equation}

Moreover, if $F$ is a forecaster that dominates $\Bd_\zeta G$ then it also dominates $G$.

\end{prop}

\begin{proof}

Equation~\ref{eqn:prp_furgal_gambler__svm_b_zeta} follows from Proposition~\ref{prp:b_stays_in_budget}. Now, consider any $F$ that dominates $\Bd_\zeta G$. For any $x \in \OO$, \ref{eqn:prp_furgal_gambler__svm_b_zeta} and Definition~\ref{def:dominance} imply

\[\sup_{n \in \Nats} {\SVX \Bd_\zeta G^F_{n}(x_{:n-1})} < +\infty\]

Consider $x \in \OO$ s.t. condition~\ref{eqn:def_dominance__loss} holds. Denote

\[b_0: = \max( -\inf_{n \in \Nats} {\SVM G^F_{n}(x_{:n-1})},0)\]

By Proposition~\ref{prp:b_no_effect}, for any $b > b_0$ we have $\Bd_b G^F = G^F$. We get

\[\sup_{n \in \Nats} \max_{x' \in x_{:n-1}\OO} (\sum_{b \leq b_0} \zeta(b) {\SV \Bd_b G^F_{n}(x_{:n-1},x')} + \sum_{b > b_0} \zeta(b) \SV G^F_{n}(x_{:n-1},x')) < +\infty\]

Applying Proposition~\ref{prp:b_stays_in_budget} to the first term

\[\sup_{n \in \Nats} \max_{x' \in x_{:n-1}\OO} (-\sum_{b \leq b_0} \zeta(b) b + \sum_{b > b_0} \zeta(b) \SV G^F_{n}(x_{:n-1},x')) < +\infty\]

\[\sup_{n \in \Nats} \SVX G^F_{n}(x_{:n-1}) < +\infty\]
\end{proof}

The last ingredient we need to prove Theorem~\ref{thm:exist_dominant} is the step from one gambler to a countable set of gamblers.

\begin{prop}
\label{prp:combining_gamblers}

Let $\Sq{G^k}{k}$ be a family of gamblers, $\xi: \Nats \rightarrow (0,1]$ and $b_\xi > 0$ s.t.

\begin{equation}
\label{eqn:prp_combining_gamblers__budget}
\sum_{k = 0}^\infty \xi(k) \min(\SVM G^k_n,0) \geq -b_\xi
\end{equation}

Define the gambler $G^\xi$ by

\begin{equation*}
G^\xi_n := \sum_{k = 0}^n \xi(k) G^k_n
\end{equation*}

Consider a forecaster $F$ that dominates $G^\xi$. Then, $F$ dominates $G^k$ for all $k \in \Nats$.

\end{prop}

\begin{proof}

Fix $k \in \Nats$ and $x \in \OO$. Equation~\ref{eqn:prp_combining_gamblers__budget} implies

\[\inf_{n \in \Nats} \SVM G^{\xi F}_{n}(x_{:n-1},x') > -\infty\]

Therefore we have

\[\sup_{n \in \Nats} \SVX G^{\xi F}_{n}(x_{:n-1}) < +\infty\]

\[\sup_{n \geq k} \max_{x' \in x_{:n-1}\OO} (\xi(k) \SV G^{k F}_{n}(x_{:n-1},x') + \sum_{\substack{j \ne k\\ j \leq n}} \xi(j) \SV G^{j F}_{n}(x_{:n-1},x')) < +\infty\]

\[\sup_{n \geq k} \max_{x' \in x_{:n-1}\OO} (\xi(k) \SV G^{k F}_{n}(x_{:n-1},x') - b_\xi) < +\infty\]

\[\sup_{n \geq k} \SVX G^{k F}_{n}(x_{:n-1}) < +\infty\]

Since there are only finitely many values of $n$ less than $k$, it follows that

\[\sup_{n \in \Nats} \SVX G^{k F}_{n}(x_{:n-1}) < +\infty\]
\end{proof}

\begin{proof}[Proof of Theorem~\ref{thm:exist_dominant}]

Define $\zeta(b) := \max(b,1)^{-3}$. By Proposition~\ref{prp:frugal_gambler}, we have

\[\SVM \Bd_{\zeta} G^k_n \geq -\frac{\pi^2}{6}\]

Define $\xi(k):=(k+1)^{-2}$.

We have

\[\sum_{k=0}^\infty \xi(k) \min(\SVM \Bd_{\zeta} G^k_n, 0) \geq -\frac{\pi^4}{36} \]

By Corollary~\ref{crl:dominate_one}, there is a forecaster $F^G$ that dominates $\Bd_\zeta G^\xi$. By Proposition~\ref{prp:combining_gamblers}, $F^G$ dominates $\Bd_\zeta G^k$ for all $k \in \Nats$. By Proposition~\ref{prp:frugal_gambler}, $F^G$ dominates $G^k$ for all $k \in \Nats$.
\end{proof}

\section{Prudent Gambling Strategies}
\label{sec:prudent}

In this section we construct a tool for proving asymptotic convergence results about dominant forecasters. We start by introducing a notion of \enquote{prudent gambling,} which requires that bets are only made when the expected payoff is a certain fraction of the risk. First, we need some notation.

Given measurable spaces $X$ and $Y$, we will use the notation $K: X \M Y$ to denote a Markov kernel with source $X$ and target $Y$. Given $x \in X$, we will use the notation $K(x) \in \PM(Y)$. Given $\mu \in \PM(X)$, $\mu \ltimes K \in \PM(X \times Y)$ denotes the semidirect product of $\mu$ and $K$. $K_* \mu \in \PM(Y)$ denotes the pushforward of $\mu$ by $K$ (i.e. the pushforward of $\mu \ltimes K$ by the projection to $Y$). When $X,Y$ are Polish and $\pi: X \rightarrow Y$ is Borel measurable, $\mu \mid \pi: Y \M X$ is defined to be s.t. $\pi_* \mu \ltimes (\mu \mid \pi)$ is supported on the graph of $\pi$ and $(\mu \mid \pi)_* \pi_* \mu = \mu$ (i.e. $\mu \mid \pi$ is a regular conditional probability). By the disintegration theorem, $\mu \mid \pi$ exists and is defined up to coincidence $\pi_* \mu$-almost everywhere. Given $g: X \rightarrow \Reals$ measurable, we will also use the notation 

\begin{equation*}
\E_{\mu}[g \mid \pi^{-1}(y)]:=\E_{(\mu \mid \pi)(y)}[g]
\end{equation*}

We remind that $\PO_n$ is the projection mapping from $\OO$ to $\Ob^n$ and $y\OO:= (\PO_{n})^{-1}(y)$.

\begin{defn}

A \emph{gambling strategy} is a uniformly bounded family of measurable mappings

\[\Sqn{S_n: \Ob^n \rightarrow \GMO}\]

\begin{defn}
\label{def:prudent}

Given a gambling strategy $S$ and $\mu^* \in \PMO$, $S$ is said to be \emph{$\mu^*$-prudent} when there is $\alpha > 0$ s.t. for any $n \in \Nats$, $\PO_{n*} \mu^*$-almost any $y \in \Ob^n$ and any $\mu \in \PMO$

\begin{equation*}
\E_{\mu^*}[S_n(y; \mu) \mid y\OO] - \E_\mu[S_n(y; \mu)] \geq \alpha (\max_{y\OO}{S_n(y; \mu)} - \min_{y\OO}{S_n(y; \mu)})
\end{equation*}

\end{defn}

\end{defn}

The \enquote{correct} way for a gambler to use a prudent gambling strategy is not employing it all the time: in order to avoid running out of budget, a gambler shouldn't place too many bets simultaneously. To address this, we define a gambler that \enquote{plays} (employs the given strategy) only when all previous bets are close to being settled.

\begin{defn}

Consider any gambling strategy $S$. We define the gambler $\PG{S}$ recursively as follows

\begin{equation*}
\PG{S}_n(y,\BM):=\begin{cases} S_n(y) \text{ if } {\SVX{\PG{S}}_n(y_{:n-1},\BM)}-{\SVM{\PG{S}}_n(y_{:n-1},\BM)} \leq 1 \\ 0 \text{ otherwise} \end{cases}
\end{equation*}

\end{defn}

\begin{thm}
\label{thm:prudent}

Consider $\mu^* \in \PMO$, $S$ a $\mu^*$-prudent gambling strategy and a forecaster $F$. Assume $F$ dominates $\PG{S}$. Then, for $\mu^*$-almost any $x \in \OO$

\begin{equation}
\label{eqn:thm_prudent}
\sum_{n=0}^\infty (\E_{\mu^*}[S_n(x_{:n};F_n(x_{:n})) \mid x_{:n}\OO]-\E_{F_n(x_{:n})}[S_n(x_{:n};F_n(x_{:n}))]) < +\infty
\end{equation}

\end{thm}

In particular, the terms of the series on the left hand-side converge to 0 (they are non-negative since $S$ is $\mu^*$-prudent).

The rest of the section is dedicated to proving Theorem~\ref{thm:prudent}.

We start by showing, in a more abstract setting (not specific to forecasting), that for any sequences of bets that is \enquote{prudent} in the sense that the expected payoff is bounded below by a fixed fraction of the risk (= bet magnitude), the probability to lose an infinite amount vanishes and, moreover, it holds with probability 1 that if the total bet magnitude is unbounded then there is infinite gain.

\begin{samepage}
\begin{lemm}
\label{lmm:prudent}

Consider $\Omega$ a probability space, $\Sqn{\F_n \subseteq 2^\Omega}$ a filtration of $\Omega$, $\alpha,M > 0$, $\Sqn{X_n: \Omega \rightarrow \Reals}$ and $\Sqn{Y_n: \Omega \rightarrow [0,M]}$ stochastic processes adapted to $\F$ (i.e. $X_n$ and $Y_n$ are $\F_n$-measurable). Assume the following conditions\footnote{Equalities and inequalities between random variables are implicitly understood as holding almost surely.}:

\begin{enumerate}[i.]

\item $\E[\A{X_0}] < +\infty$
\item $\forall n \in \Nats, m \geq n: \A{X_n - X_m} \leq \sum_{l=n}^{m-1} Y_l + M$
\item $\E[X_{n+1} \mid \F_n] \geq X_n + \alpha Y_n$

\end{enumerate}

Then, for almost all $\omega \in \Omega$

\begin{enumerate}[a.]

\item\label{itm:lmm_prudent__inf} $\inf_n X_n(\omega) > -\infty$
\item\label{itm:lmm_prudent__sup} If $\sup_n X_n(\omega) < +\infty$ then $\sum_n Y_n(\omega) < +\infty$

\end{enumerate}

\end{lemm}
\end{samepage}

\begin{proof}

Without loss of generality, we can assume ${M = 1}$ (otherwise we can renormalize ${X}$ and ${Y}$ by a factor of ${M^{-1}}$). Define ${\Sqn{X^0_n: \Omega \rightarrow \Reals}}$ by

$$X^0_n := X_n - \alpha \sum_{m=0}^{n-1} Y_m$$

It is easy to see that ${X^0}$ is a submartingale.

We define ${\Sqn{N_n:\Omega \rightarrow \Nats \sqcup \{\infty\}}}$ recursively as follows

\begin{align*}
N_0(\omega) &:= 0 \\ 
N_{k+1}(\omega) &:= \begin{cases}\inf \{n \in \Nats \mid \sum_{m=N_k(\omega)}^{n-1} Y_m(\omega) \geq 1\} \text{ if } N_k(\omega) < \infty\\\infty \text{ if } N_k(\omega) = \infty\end{cases}
\end{align*}

For each $k \in \Nats$, $N_k$ is a stopping time w.r.t. ${\F}$. As easy to see, for each $k \in \Nats$, ${\Sqn{X^0_{\min(n,N_k)}}}$ is a uniformly integrable submartingale. Using the fact that ${N_{k} \leq N_{k+1}}$ to apply Theorem~\ref{thm:optional_stopping} (see Appendix), we get

$$\E[X^0_{N_{k+1}} \mid \F_{N_k}] \geq X^0_{N_{k}}$$

Clearly, ${\Sq{X^0_{N_k}}{k}}$ is adapted to ${\Sq{\F_{N_k}}{k}}$. Doob's second martingale convergence theorem implies that ${\E[\A{X^0_{N_k}}] < \infty}$ (${X^0_{N_k}}$ is the limit of the uniformly integrable submartingale ${\Sqn{X^0_{\min(n,N_k)}}}$). We conclude that ${\Sq{X^0_{N_k}}{k}}$ is a submartingale.

It is easy to see that ${\A{X^0_{N_{k+1}}-X^0_{N_k}}} \leq 3$. Applying the Azuma-Hoeffding inequality, we conclude that for any positive integer ${k}$:

$$\Pr[X^0_{N_k} - X_0 < -k^{\frac{3}{4}}] \leq \exp(-\frac{k^{\frac{3}{2}}}{2 \cdot 3^2k})=\exp(-\frac{k^{\frac{1}{2}}}{18})$$

It follows that

$$\sum_{k=1}^\infty \Pr[X^0_{N_k} - X_0 < -k^{\frac{3}{4}}] < \infty$$

$$\Pr[\exists k \in \Nats \forall l > k: X^0_{N_l} - X_0 \geq -l^{\frac{3}{4}}] = 1$$

$$\Pr[\exists k \in \Nats \forall l > k: X_{N_l} - X_0 \geq \alpha \sum_{n=0}^{N_l - 1} Y_n - l^{\frac{3}{4}}] = 1$$

%$$\Pr[\exists m \in \Nats \forall k \in \Nats: X^0_{N_k} \leq m - \alpha k] = 0$$

It is easy to see that if $\omega \in \Omega$ is s.t. $\sum_{n=0}^\infty Y_n(\omega) = \infty$ then $\sum_{n=0}^{N_l(\omega) - 1} Y_n(\omega) \geq l$. We get

$$\Pr[\sum_{n=0}^\infty  Y_n = \infty \implies \exists k \in \Nats \forall l > k: X_{N_l} - X_0 \geq \alpha l - l^{\frac{3}{4}}]=1$$

\begin{sloppypar}
To complete the proof, observe that if ${\omega \in \Omega}$ is s.t. ${\inf_n X_n(\omega) = -\infty}$ then ${\sum_{n=0}^\infty  Y_n(\omega) = \infty}$ (since ${\A{X_n(\omega) - X_0(\omega)} \leq \sum_{m=0}^{n-1} Y_n(\omega) + 1}$).
\end{sloppypar}
\end{proof}

\begin{samepage}
\begin{cor}
\label{crl:prudent}

Consider $\Omega$ a probability space, $\Sqn{\F_n \subseteq 2^\Omega}$ a filtration of $\Omega$, $\alpha,M > 0$, $\Sqn{X'_n: \Omega \rightarrow \Reals}$ and $\Sqn{Y_n: \Omega \rightarrow [0,M]}$ stochastic processes adapted to $\F$ and $\Sqn{X_n: \Omega \rightarrow \Reals}$ an arbitrary stochastic process. Assume the following conditions:

\begin{enumerate}[i.]

\item $\A{X_n - X'_n} \leq M$
\item $\E[\A{X_0}] < +\infty$
\item $\A{X_{n+1} - X_n} \leq Y_n$
\item $\E[X_{n+1} - X_n \mid \F_n] \geq \alpha Y_n$

\end{enumerate}

Then, for almost all $\omega \in \Omega$

\begin{enumerate}[a.]

\item\label{itm:crl_prudent__inf} $\inf_n X_n(\omega) > -\infty$
\item\label{itm:crl_prudent__sup} If $\sup_n X_n(\omega) < +\infty$ then $\sum_n Y_n(\omega) < +\infty$

\end{enumerate}

\end{cor}
\end{samepage}

\begin{proof}

Define ${X''_n:= \E[X_n \mid \F_n]}$. We have

$$\E[\A{X''_0}] = \E[\A{\E[X_0 \mid \F_0]}] \leq \E[\E[\A{X_0} \mid \F_0]] = \E[\A{X_0}] < \infty$$

$$\A{X''_n - X'_n} = \A{\E[X_n \mid \F_n] - X'_n} = \A{\E[X_n - X'_n \mid \F_n]} \leq M$$

$$\A{X''_n - X_n} \leq \A{X''_n - X'_n} + \A{X'_n - X_n} \leq 2M$$

$$\forall m \geq n: \A{X''_{m}-X''_n} \leq \A{X_{m}-X_n} + 4M \leq \sum_{l=n}^{n-1} Y_l + 4M$$

$$\E[X''_{n+1}-X''_n \mid \F_n] = \E[\E[X_{n+1} \mid \F_{n+1}]-\E[X_n \mid \F_n] \mid \F_n] = \E[X_{n+1}-X_n \mid \F_n] \geq \alpha Y_n$$

Applying Lemma~\ref{lmm:prudent} to $X''$ and using ${\A{X''_n - X_n} \leq 2M}$, we get the desired result.
\end{proof}

We will also need the following property of the operator $\PG$, reflecting that at any given moment, the uncertainty of the gambler $\PG{S}$ about the total worth of its bets is bounded.

\begin{samepage}
\begin{prop}
\label{prp:pg_bounded_uncertainty}

Given any gambling strategy $S$, we have

\begin{equation*}
\SV \PG{S}_n - \SVM \PG{S}_n \leq 2 \max_{m < n} \sup_{y \in \Ob^m} \N{S_m(y)} + 1
\end{equation*}

In particular, the left hand side is uniformly bounded.

\end{prop}
\end{samepage}

\begin{proof}

We prove by induction. For $n=0$ the claim is obvious. Consider any ${n \in \Nats}$, $y \in \Ob^{n}$ and $\BM \in \PMO^{n+1}$. First, assume that

$$\SVX \PG{S}_n(y_{:n-1},\BM_{:n}) - \SVM \PG{S}_n(y_{:n-1},\BM_{:n}) > 1$$

Then, by definition of ${\PG{S}}$, ${\PG{S}_n}(y,\BM_{:n}) \equiv 0$ and therefore

$$\SV \PG{S}_{n+1}(y,\BM)=\SV \PG{S}_n(y_{:n-1},\BM_{:n})$$

$$\SVM \PG{S}_{n+1}(y,\BM) \geq \SVM \PG{S}_n(y_{:n-1},\BM_{:n})$$

$$\SV \PG{S}_{n+1}(y,\BM) - \SVM \PG{S}_{n+1}(y,\BM) \leq \SV \PG{S}_n(y_{:n-1},\BM_{:n}) - \SVM \PG{S}_n(y_{:n-1},\BM_{:n}) $$

By the induction hypothesis, we get

$$\SV \PG{S}_{n+1}(y,\BM) - \SVM \PG{S}_{n+1}(y,\BM) \leq  2 \max_{m < n} \sup_{y \in \Ob^m} \N{S_m(y)}  + 1 \leq \max_{m \leq n} \sup_{y \in \Ob^m} \N{S_m(y)}  + 1$$

Now, assume that 

$$\SVX \PG{S}_n(y_{:n-1},\BM_{:n}) - \SVM \PG{S}_n(y_{:n-1},\BM_{:n}) \leq 1$$

Then, ${\PG{S}_n}(y,\BM_{:n}) = {S_n}(y)$ and therefore

$$\SV \PG{S}_{n+1}(y,\BM)=\SV \PG{S}_n(y_{:n-1},\BM_{:n}) + (\V{S}_n(y))(\BM_n)$$

We get

\begin{multline*}
\SV \PG{S}_{n+1}(y,\BM) - \SVM \PG{S}_{n+1}(y,\BM) \leq \SVX \PG{S}_n(y_{:n-1},\BM_{:n}) - \\ \SVM \PG{S}_n(y_{:n-1},\BM_{:n}) + 2 \N{S_n(y)}
\end{multline*}

By the assumption, the first two terms total to ${\leq 1}$, yielding the desired result.
\end{proof}

As a final ingredient for the proof of Theorem~\ref{thm:prudent}, we will need another property of $\PG$, namely that when the total magnitude of all bets made is finite, the gambler eventually starts \enquote{playing} in every round.

\begin{samepage}
\begin{prop}
\label{prp:when_bounded_play}

Let $S$ be a gambling strategy, $F$ a forecaster and $x \in \OO$. Assume that

\begin{equation*}
\sum_{n=0}^\infty {(\max_{x_{:n}\OO} \overline{\PG{S}}^F_n(x_{:n})-\min_{x_{:n}\OO} \overline{\PG{S}}^F_n(x_{:n}))} < +\infty
\end{equation*}

Then, for any $n \gg 0$, $\PG{S}^F_n(x_{:n})=S_n(x_{:n})$.

\end{prop}
\end{samepage}

\begin{proof}

Choose $n_0 \in \Nats$ s.t. 

$$\sum_{n=n_0}^\infty {(\max_{x_{:n}\OO} \overline{\PG{S}}^F_n(x_{:n})-\min_{x_{:n}\OO} \overline{\PG{S}}^F_n(x_{:n}))} < \frac{1}{2}$$

Since $\overline{\PG{S}}^F_n(x_{:n}), \overline{\V{\PG{S}}}^F_n(x_{:n}) \in \CO$ differ by a constant function, we have

$$\sum_{n=n_0}^\infty {(\max_{x_{:n}\OO} \overline{\V{\PG{S}}}^F_n(x_{:n})-\min_{x_{:n}\OO} \overline{\V{\PG{S}}}^F_n(x_{:n}))} < \frac{1}{2}$$

In particular, for any $n \geq n_0$

$$\sum_{m=n_0}^{n-1} {(\max_{x_{:n}\OO} \overline{\V{\PG{S}}}^F_m(x_{:m})-\min_{x_{:n}\OO} \overline{\V{\PG{S}}}^F_m(x_{:m}))} < \frac{1}{2}$$

On the other hand, it is easy to see that there is $n_1 \geq n_0$ s.t. for any $n \geq n_1$

$$\max_{x_{:n}\OO} \SV{\PG{S}}_{n_0}^F(x_{:n_0 - 1}) - \min_{x_{:n}\OO} \SV{\PG{S}}_{n_0}^F(x_{:n_0 - 1}) < \frac{1}{2}$$

Taking the sum of the last two inequalities, we conclude that for any $n \geq n_1$

$$\SVX{\PG{S}}_{n}^F(x_{:n-1}) - \SVM{\PG{S}}_{n}^F(x_{:n-1}) < 1$$

Using the definition of $\PG{S}$, we get the desired result.
\end{proof}

\begin{proof}[Proof of Theorem~\ref{thm:prudent}]

We regard ${\OO}$ as a probability space using the ${\sigma}$-algebra $\F$ of universally measurable sets and the probability measure ${\mu^*}$. For any ${n \in \Nats}$, we define ${\F_n \subseteq \F}$ and $X_n,X'_n,Y_n: \OO \rightarrow \Reals$ by 

$$\F_n := \{(\PO_n)^{-1}(A) \mid A \subseteq \Ob^n \text{ universally measurable}\}$$

$$X_n(x):= \SV \PG{S}^F_{n}(x_{:n-1},x)$$

$$X'_n(x):= \SVM \PG{S}^F_{n}(x_{:n-1})$$

$$Y_n(x):=\max_{x_{:n}\OO} \overline{\PG{S}}^F_{n}(x_{:n}) - \min_{x_{:n}\OO} \overline{\PG{S}}^F_{n}(x_{:n})$$

Clearly, ${\F}$ is a filtration of ${\OO}$, ${X,X',Y}$ are stochastic processes and ${X',Y}$ are adapted to ${\F}$. ${S}$ is uniformly bounded, therefore ${\PG{S}}$  is uniformly bounded and so is ${Y}$. Obviously, ${Y}$ is also non-negative.

By Proposition~\ref{prp:pg_bounded_uncertainty}, ${\A{X_n-X'_n}}$ are uniformly bounded. ${X_0}$ vanishes and in particular ${\E[\A{X_0}] < \infty}$. We have

$$\A{X_{n+1}(x)-X_n(x)} = \A{\overline{\V{\PG{S}}}_{n}^F(x_{:n},x)} \leq Y_n(x)$$

Moreover:

$$\E[X_{n+1} - X_n \mid \F_n](x) = \E_{x' \sim \mu^*}[\overline{\V{\PG{S}}}_{n}^F(x_{:n},x') \mid x' \in x_{:n}\OO]$$

(As before, the notation on the right hand side signifies the use of a regular conditional probability)

$$\E[X_{n+1} - X_n \mid \F_n](x) = \E_{x' \sim \mu^*}[\overline{\PG{S}}_{n}^F(x_{:n},x') \mid x' \in x_{:n}\OO] - \E_{x' \sim F_n(x_{:n})}[\overline{\PG{S}}_{n}^F(x_{:n},x')]$$

Let $\alpha > 0$ be as in Definition~\ref{def:prudent}. By definition of $\PG{S}$, $\overline{\PG{S}}_{n}^F(x_{:n})$ is equal to either $S_n(x_{:n};F_n(x_{:n}))$ or 0. In either case, we get that for $\mu^*$-almost any $x \in \OO$

$$\E[X_{n+1} - X_n \mid \F_n](x) \geq \alpha (\max_{x_{:n}\OO} \overline{\PG{S}}_{n}^F(x_{:n}) - \min_{x_{:n}\OO} \overline{\PG{S}}_{n}^F(x_{:n})) = \alpha Y_n(x)$$

By Corollary~\ref*{crl:prudent}\ref{itm:crl_prudent__inf}, for $\mu^*$-almost any $x \in \OO$

\[\inf_{n \in \Nats} \SVM \PG{S}^F_{n}(x_{:n-1}) > -\infty\]

Since $F$ dominates $\PG{S}$, it follows that

\[\sup_{n \in \Nats} \SVX \PG{S}^F_{n}(x_{:n-1}) < +\infty\] 

By Corollary~\ref*{crl:prudent}\ref{itm:crl_prudent__sup}, $\sum_n Y_n(x) < \infty$. By Proposition~\ref{prp:when_bounded_play}, it follows that for any $n \gg 0$, $\PG{S}^F_n(x_{:n}) = S_n(x_{:n})$. We get, for $n \gg 0$

\begin{multline*}
\E_{\mu^*}[S_n(x_{:n};F_n(x_{:n})) \mid x_{:n}\OO]-\E_{F_n(x_{:n})}[S_n(x_{:n};F_n(x_{:n}))] = \\ \E_{\mu^*}[\overline{\PG{S}}^F_n(x_{:n}) \mid x_{:n}\OO]-\E_{F_n(x_{:n})}[\overline{\PG{S}}^F_n(x_{:n})]
\end{multline*}

$$\E_{\mu^*}[S_n(x_{:n};F_n(x_{:n})) \mid x_{:n}\OO]-\E_{F_n(x_{:n})}[S_n(x_{:n};F_n(x_{:n}))] \leq Y_n(x)$$

$$\sum_{n=0}^\infty (\E_{\mu^*}[S_n(x_{:n};F_n(x_{:n})) \mid x_{:n}\OO]-\E_{F_n(x_{:n})}[S_n(x_{:n};F_n(x_{:n}))]) < +\infty$$
\end{proof}

\section{Proof of Main Theorem}
\label{sec:construction}

In order to prove Theorem~\ref{thm:main}, we will need, given an incomplete model $M \subseteq \PMO$ and $\epsilon > 0$, a gambling strategy $S^{M\epsilon}$ s.t. $S^{M\epsilon}$ is $\mu$-prudent for any $\mu \in M$ and s.t. Theorem~\ref{thm:prudent} implies that any $F$ that dominates $S^{M\epsilon}$ satisfies equation~\ref{eqn:thm_main} \enquote{within $\epsilon$.} This motivates the following definition and lemma.

\begin{samepage}
\begin{defn}

Consider $X$ a compact Polish metric space, $M \subseteq \PM(X)$ convex and $r_0 > 0$. $\beta \in \Gm(X)$ is said to be \emph{$(M,r_0)$-savvy} when for any $\mu \in \PM(X)$, denoting $r_\mu:=\DKR(\mu,M)$:

\begin{enumerate}[i.]

\item $\N{\beta(\mu)} \leq \max(r_\mu - r_0,0)$
\item $\forall \nu \in M: \E_\nu[\beta(\mu)] - \E_\mu[\beta(\mu)] \geq \frac{1}{2}(r_\mu - r_0) r_\mu$

\end{enumerate}

\end{defn}
\end{samepage}

\begin{samepage}
\begin{lemm}
\label{lmm:savvy}

Consider $X$ a compact Polish metric space, $Y$ a compact Polish space and $M: Y \rightarrow 2^{\PM(X)}$. Denote

\begin{equation*}
\Gr{M}:=\{(y, \mu) \in Y \times \PM(X) \mid \mu \in M(y)\}
\end{equation*}

Assume that $\Gr{M}$ is closed and that $M(y)$ is convex for any $y \in Y$. Regard $Y$ as a measurable space using the $\sigma$-algebra of universally measurable sets and regard $\Gm(X)$ as a measurable space using the $\sigma$-algebra of Borel sets. Then, for any $\epsilon > 0$, there exists $S^\epsilon: Y \rightarrow \Gm(X)$ measurable s.t. for all $y \in Y$, $S^\epsilon(y)$ is $(M(y),\epsilon)$-savvy.

\end{lemm}
\end{samepage}

In order to prove Lemma~\ref{lmm:savvy}, we will need a few other technical lemmas.

\begin{samepage}
\begin{lemm}
\label{lmm:double_dual}

Consider $X$ a compact Polish space, $\rho$ a metrization of $X$, $\varphi \in \Lp(X,\rho)''$ and $\epsilon > 0$. Then, there exists $f \in \Lp(X,\rho)$ s.t.

\begin{enumerate}[i.]

\item $\N{f}_\rho \leq \N{\varphi}$
\item $\forall \mu \in \PM(X): \A{\E_\mu[f] - \varphi(\mu)} < \epsilon$

\end{enumerate}

\end{lemm}
\end{samepage}

\begin{proof}

Without loss of generality, assume that $\N{\varphi}=1$ (if $\N{\varphi}=0$ the theorem is trivial, otherwise we can rescale everything by a scalar). Using the compactness of $\PM(X)$, choose a finite set $A \subseteq \PM(X)$ s.t. 

$$\max_{\mu \in \PM(X)} \min_{\nu \in A}\, \DKR(\mu,\nu) < \frac{\epsilon}{4}$$

Using the Goldstine theorem, choose $f \in \Lp(X)$ s.t. $\N{f}_\rho \leq 1$ and for any $\nu \in A$ 

$$\A{\E_\nu[f] - \varphi(\nu)} < \frac{\epsilon}{2}$$

Consider any $\mu \in \PM(X)$. Choose $\nu \in A$ s.t. $\DKR(\mu,\nu) < \frac{\epsilon}{4}$. We get

$$\A{\E_\mu[f] - \varphi(\mu)} \leq \A{\E_\mu[f] - \E_\nu[f]} + \A{\E_\nu[f] - \varphi(\nu)} + \A{\varphi(\nu) - \varphi(\mu)} < \frac{\epsilon}{4} + \frac{\epsilon}{2} + \frac{\epsilon}{4} = \epsilon$$
\end{proof}

\begin{samepage}
\begin{lemm}
\label{lmm:separation}

Consider $X$ a compact Polish space, $\rho$ a metrization of $X$, $M \subseteq \PM(X)$ convex non-empty, $r_0 > 0$ and $\mu_0 \in \PM(X)$ s.t. $r:=\DKR(\mu_0,M) > r_0$. Then, there exists $f \in \Lp(X,\rho)$ s.t.

\begin{enumerate}[i.]

\item $\N{f}_\rho < r - r_0$
\item $\inf_{\nu \in M} \E_\nu[f] - \E_\mu[f] > \frac{1}{2}(r-r_0)r$

\end{enumerate}

\end{lemm}
\end{samepage}

\begin{proof}

Define $M^r \subseteq \Lp(X,\rho)'$ by

$$M^r:=\{\mu \in \Lp(X,\rho)' \mid \inf_{\nu \in M} \N{\mu - \nu} < r\}$$

By the Hahn-Banach separation theorem, there is $\varphi \in \Lp(X,\rho)''$ s.t. for all $\nu \in M^r$, $\varphi(\nu) > \varphi(\mu_0)$. Multiplying by a scalar, we can make sure that $\N{\varphi} = \frac{3}{4}(r - r_0)$. For any $\delta > 0$, we can choose $\zeta \in \Lp(X,\rho)'$ s.t. $\N{\zeta} < 1$ and $\varphi(\zeta) > \frac{3}{4}(r-r_0) - \delta$.  For any $\nu \in M$, $\nu - r \zeta \in M^r$ and therefore

$$\varphi(\nu - r \zeta) > \varphi(\mu_0)$$

$$\varphi(\nu) > \varphi(\mu_0) + r \varphi(\zeta) > \varphi(\mu_0) + r (\frac{3}{4}(r-r_0) - \delta)$$

Taking $\delta$ to 0 we get $\varphi(\nu) \geq \varphi(\mu_0) + \frac{3}{4} r (r - r_0)$. Applying Lemma~\ref{lmm:double_dual} for $\epsilon = \frac{1}{16} r (r - r_0)$, we get $f \in \Lp(X,\rho)$ s.t.

$$\N{f}_\rho \leq \frac{3}{4} (r - r_0) < r - r_0$$ 

$$\E_\nu[f] \geq \varphi(\nu) - \frac{1}{16} r (r - r_0) \geq \varphi(\mu_0) + \frac{11}{16} r (r - r_0) \geq \E_{\mu_0}[f] +  \frac{5}{8} r (r - r_0) > \E_{\mu_0}[f] +  \frac{1}{2} r (r - r_0)$$
\end{proof}

\begin{samepage}
\begin{lemm}
\label{lmm:savvy_outside}

Consider $X$ a compact Polish space, $\rho$ a metrization of $X$, $M \subseteq \PM(X)$ convex non-empty and $r_0 > 0$. Define $U \subseteq \PM(X)$ by

\begin{equation*}
U := \{\mu \in \PM(X) \mid \DKR(\mu,M) > r_0\}
\end{equation*}

Then, there exists $\beta': U \rightarrow \Lp(X,\rho)$ continuous s.t. for all $\mu \in U$, denoting $r_\mu:=\DKR(\mu,M)$:

\begin{enumerate}[i.]

\item $\N{\beta'(\mu)}_\rho < r_\mu - r_0$
\item $\inf_{\nu \in M} \E_\nu[\beta'(\mu)] - \E_\mu[\beta'(\mu)] > \frac{1}{2} (r_\mu - r_0) r_\mu$

\end{enumerate}

\end{lemm}
\end{samepage}

\begin{proof}

Define $B: U \rightarrow 2^{\Lp(X,\rho)}$ by

$$B(\mu):=\{f \in \Lp(X,\rho) \mid \N{f}_\rho < r_\mu - r_0,\, \inf_{\nu \in M} \E_\nu[f] - \E_\mu[f] > \frac{1}{2}(r_\mu - r_0) r_\mu\}$$

By Lemma~\ref{lmm:separation}, for any $\mu \in U$, $B(\mu) \ne \varnothing$. Clearly, $B(\mu)$ is convex. Fix $f \in \Lp(X,\rho)$ and consider $B^{-1}(f):=\{\mu \in U \mid f \in B(\mu)\}$. Consider any $\mu_0 \in B^{-1}(f)$, and take $\epsilon > 0$ s.t.

\begin{enumerate}[i.]

\item $\N{f}_\rho < r_{\mu_0}  - \epsilon - r_0$
\item $\inf_{\nu \in M} \E_\nu[f] - \E_{\mu_0}[f] -\epsilon > \frac{1}{2}(r_{\mu_0} + \epsilon  - r_0) (r_{\mu_0} + \epsilon)$

\end{enumerate}

Define $V \subseteq U$ by 

$$V := \{\mu \in U \mid \DKR(\mu,\mu_0) < \epsilon,\, \E_\mu[f] < \E_{\mu_0}[f] + \epsilon\}$$

Obviously $V$ is open and $V \subseteq B^{-1}(f)$, hence $B^{-1}(f)$ is open. Applying Theorem~\ref{thm:selection} (see Appendix), we get the desired result.
\end{proof}

\begin{samepage}
\begin{cor}
\label{crl:savvy}

Consider $X$ a compact Polish metric space, $M \subseteq \PM(X)$ convex and $r_0 > 0$. Then, there exists $\beta \in \Gm(X)$ which is $(M,r_0)$-savvy.

\end{cor}
\end{samepage}

\begin{proof}

If $M$ is empty, the claim is trivial, so assume $M$ is non-empty. Let $U \subseteq \PM(X)$ be defined by

$$U:=\{\mu \in \PM(X) \mid \DKR(\mu, M) > r_0\}$$

Use Lemma~\ref{lmm:savvy_outside} to obtain $\beta': U \rightarrow \Lp(X)$. Define $\beta: \PM(X) \rightarrow \Lp(X)$ by

$$\beta(\mu):=\begin{cases}\beta'(\mu) \text{ if } \mu \in U\\0 \text { if } \mu \not\in U\end{cases}$$ 
Obviously $\beta$ is continuous in $U$. Consider any $\mu \not\in U$ and $\Sq{\mu_k \in \PM(X)}{k}$ s.t. $\lim_{k \rightarrow \infty} \mu_k = \mu$. We have 

$$\lim_{k \rightarrow \infty} \DKR(\mu_k,M) = \DKR(\mu, M) \leq r_0$$

Denote the metric on $X$ by $\rho$. 

$$\limsup_{k \rightarrow \infty}{\N{\beta(\mu_k)}_\rho} \leq \limsup_{k \rightarrow \infty}{\max(\DKR(\mu_k,M) - r_0, 0)} = 0$$

Therefore, $\beta$ is continuous everywhere.
\end{proof}

\begin{proof}[Proof of Lemma~\ref{lmm:savvy}]

Define $Z_{1,2,3} \subseteq Y \times \Gm(X) \times \PM(X)^4$ by

$$Z_1:=\{(y,\beta,\mu,\nu,\xi,\zeta) \in Y \times \Gm(X) \times \PM(X)^4 \mid \zeta \in M(y)\}$$

$$Z_2:=\{(y,\beta,\mu,\nu,\xi,\zeta) \in Y \times \Gm(X) \times \PM(X)^4 \mid \N{\beta(\mu)} \leq \max(\DKR(\mu,\xi) - \epsilon, 0)\}$$

\begin{multline*}
Z_3:=\{(y,\beta,\mu,\nu,\xi,\zeta) \in Y \times \Gm(X) \times \PM(X)^4 \mid \E_\nu[\beta(\mu)] - \\ \E_\mu[\beta(\mu)] \geq \frac{1}{2}\max(\DKR(\mu,\zeta) - \epsilon, 0) \DKR(\mu,\zeta)\}
\end{multline*}

Define $Z := Z_1 \cap Z_2 \cap Z_3$. It is easy to see that $Z_{1,2,3}$ are closed and therefore $Z$ also. Define $Z' \subseteq Y \times \Gm(X) \times \PM(X)^3$ by

$$Z':=\{(y,\beta,\mu,\nu,\xi) \in Y \times \Gm(X) \times \PM(X)^3 \mid \exists \zeta \in \PM(X): (y,\beta,\mu,\nu,\xi,\zeta) \in Z\}$$

$Z'$ is closed since it is the projection of $Z$ and $\PM(X)$ is compact. The $M(y)$ are compact, therefore $\DKR(\mu,M(y))=\DKR(\mu,\zeta)$ for some $\zeta \in M(y)$, and hence $(y,\beta,\mu,\nu,\xi) \in Z'$ if and only if the following conditions hold:

\begin{enumerate}[i.]

\item $\N{\beta(\mu)} \leq \max(\DKR(\mu,\xi) - \epsilon, 0)$
\item $\E_\nu[\beta(\mu)] - \E_\mu[\beta(\mu)] \geq \frac{1}{2}\max(\DKR(\mu,M(y)) - \epsilon, 0) \DKR(\mu,M(y))$

\end{enumerate}

Define $W \subseteq Y \times \Gm(X) \times \PM(X)^3$ by

$$W:=\{(y,\beta,\mu,\nu,\xi) \in Y \times \Gm(X) \times \PM(X)^3 \mid \nu,\xi \in M(y),\, (y,\beta,\mu,\nu,\xi) \not\in Z'\}$$

$W$ is locally closed and in particular it is an $F_\sigma$ set. Define $W' \subseteq Y \times \Gm(X)$ by

$$W':=\{(y,\beta) \in Y \times \Gm(X) \mid \exists \mu,\nu,\xi \in \PM(X): (y,\beta,\mu,\nu,\xi) \in W\}$$

$W'$ is the projection of $W$ and $\PM(X)^3$ is compact, therefore $W'$ is $F_\sigma$. Let $A \subseteq Y \times \Gm(X)$ be the complement of $W'$. $A$ is $G_\delta$ and in particular Borel. As easy to see, $(y,\beta) \in A$ if and only if $\beta$ is $(M(y),\epsilon)$-savvy.

For any $y \in Y$, $A_y:=\{\beta \in \Gm(X) \mid (y,\beta) \in A\}$ is closed since

$$A_y = \bigcap_{\mu \in \PM(X)} \bigcap_{\nu,\xi \in M(y)} \{\beta \in \Gm(X) \mid (y,\beta,\mu,\nu,\xi) \in Z'\}$$

Moreover, $A_y$ is non-empty by Corollary~\ref{crl:savvy}.

Consider any $U \subseteq \Gm(X)$ open. Then, $A \cap (Y \times U)$ is Borel and therefore its image under the projection to $Y$ is analytic and in particular universally measurable. Applying the Kuratowski--Ryll-Nardzewski measurable selection theorem, we obtain a measurable selection of the multivalued mapping with graph $A$. This selection is the desired $S^\epsilon$.
\end{proof}

We will also need to show that Definition~\ref{def:update_incomplete} is compatible with the standard notion of regular conditional probability. This is established by the following lemma.

We remind that given $X,Y$ Polish, $\pi: X \rightarrow Y$ Borel measurable and $\mu \in \PM(X)$, $\mu \mid \pi: Y \M\ X$ stands for any corresponding regular conditional probability.

\begin{samepage}
\begin{lemm}
\label{lmm:update_incomplete}

Consider $X$ a compact Polish space, $d \in \Nats$, $Y$ a compact subset of $\Reals^d$, $\pi: X \rightarrow Y$ continuous and $\mu \in \PM(X)$. Then, for $\pi_*\mu$-almost any $y \in Y$

\begin{equation*}
\lim_{r \rightarrow 0}{\mu \mid \pi^{-1}(\B_r(y)) = (\mu \mid \pi)(y)}
\end{equation*}

\end{lemm}
\end{samepage}

\begin{proof}

Let $\Sq{f_k \in C(X)}{k}$ be dense in $C(X)$. For any $y \in Y$ and $r > 0$ we denote $\chi_{yr}: Y \rightarrow \{0,1\}$ the characteristic function of $\B_r(y)$ and $\chi^\pi_{yr}: X \rightarrow \{0,1\}$ the characteristic function of $\pi^{-1}(\B_r(y))$. For any $k \in \Nats$ and $y_0 \in \Sp \pi_* \mu$ we have $\mu(\pi^{-1}(\B_r(y_0))) = \pi_*\mu(\B_r(y_0)) > 0$ and

\begin{multline*}
\E_{\mu}[f_k \mid \pi^{-1}(\B_r(y_0))] = \frac{\E_{\mu}[\chi^\pi_{y_0r} f_k]}{\mu(\pi^{-1}(\B_r(y_0)))} = \\ \frac{\E_{y \sim \pi_* \mu}[\E_{\mu}[\chi^\pi_{y_0r} f_k \mid \pi^{-1}(y)]]}{\pi_*\mu(\B_r(y_0))} = \frac{\E_{y \sim \pi_* \mu}[\chi_{y_0r} \E_{\mu}[f_k \mid \pi^{-1}(y)]]}{\pi_*\mu(\B_r(y_0))}
\end{multline*}

In particular, the above holds for $\pi_* \mu$-almost any $y_0 \in Y$. Applying the Lebesgue differentiation theorem, we conclude that there is $A \subseteq Y$ s.t. $\pi_*\mu(A) = 1$ and for any $y \in A$

$$\forall k \in \Nats: \lim_{r \rightarrow 0} \E_{\mu}[f_k \mid \pi^{-1}(\B_r(y))] = \E_{\mu}[f_k \mid \pi^{-1}(y)]$$

Now consider any $f \in C(X)$. For any $\epsilon > 0$, there is $k \in \Nats$ s.t. $\N{f-f_k} < \epsilon$ and therefore, for any $y \in A$

\begin{multline*}
\limsup_{r \rightarrow 0} \E_{\mu}[f \mid \pi^{-1}(\B_r(y))] \leq \limsup_{r \rightarrow 0} \E_{\mu}[f_k \mid \pi^{-1}(\B_r(y))] + \\ \epsilon = \E_{\mu}[f_k \mid \pi^{-1}(y)] + \epsilon  \leq \E_{\mu}[f \mid \pi^{-1}(y)] + 2\epsilon
\end{multline*}

Similarly

$$\liminf_{r \rightarrow 0} \E_{\mu}[f \mid \pi^{-1}(\B_r(y))] \geq \E_{\mu}[f \mid \pi^{-1}(y)] - 2\epsilon$$

Taking $\epsilon$ to 0, we conclude that

$$\lim_{r \rightarrow 0} \E_{\mu}[f \mid \pi^{-1}(\B_r(y))] = \E_{\mu}[f \mid \pi^{-1}(y)]$$

$$\lim_{r \rightarrow 0} \mu \mid \pi^{-1}(\B_r(y)) = (\mu \mid \pi)(y)$$
\end{proof}

We can now obtain a relation between the notions of savviness and prudence.

\begin{samepage}
\begin{cor}
\label{crl:savvy_is_prudent}

Consider $M \subseteq \PMO$ and $\epsilon > 0$. Let $S$ be a gambling strategy s.t. for each $n \in \Nats$ and $y \in \Ob^n$, $S_n(y)$ is $(M \mid y,\, \epsilon)$-savvy (relatively to $\rho_n$). Then, $S$ is $\mu^*$-prudent for any $\mu^* \in M$.

\end{cor}
\end{samepage}

\begin{proof}

Fix any $\mu^* \in M$. By Lemma~\ref{lmm:update_incomplete}, for $\PO_{n*} \mu$-almost any $y \in Y$

$$\lim_{r \rightarrow 0} {\mu^* \mid (\PO_n)^{-1}(\B_r(y))} = (\mu^* \mid \PO_n)(y)$$

Therefore, ${(\mu^* \mid \PO_n)(y) \in M \mid y}$. Since $S_n(y)$ is $(M \mid y,\, \epsilon)$-savvy, for any $\mu \in \PM(X)$, denoting $r_{\mu y}:=\DKR^n(\mu,\,M \mid y)$:

$$\E_{\mu^*}[S_n(y;\mu) \mid y\OO] - \E_{\mu}[S_n(y;\mu)] \geq \frac{1}{2} \max(r_{\mu y} - \epsilon, 0) r_{\mu y} \geq \frac{1}{2} \N{S_n(y;\mu)} r_{\mu y}$$

When $r_{\mu y} \leq \epsilon$, $S_n(y;\mu) = 0$, hence for any $\mu \in \PM(X)$, $\N{S_n(y;\mu)} r_{\mu y} \geq \N{S_n(y;\mu)} \epsilon$. We get

$$\E_{\mu^*}[S_n(y;\mu) \mid y\OO] - \E_{\mu}[S_n(y;\mu)] \geq \frac{\epsilon}{2} \N{S_n(y;\mu)}$$
\end{proof}

\begin{samepage}
\begin{cor}
\label{crl:vicinity_convergence}

Consider $M \subseteq \PMO$ and $\epsilon > 0$. Let $S$ be a gambling strategy s.t. for each $n \in \Nats$ and $y \in \Ob^n$, $S_n(y)$ is $(M \mid y,\, \epsilon)$-savvy. Let $F$ be a forecaster that dominates $\PG{S}$. Then, for any $\mu \in M$ and $\mu$-almost any $x \in \OO$

\begin{equation*}
\limsup_{n \rightarrow \infty} \DKR^n(F_n(x_{:n}),\, M \mid x_{:n}) \leq \epsilon
\end{equation*}

\end{cor}
\end{samepage}

\begin{proof}

By Corollary~\ref{crl:savvy_is_prudent}, $S$ is $\mu$-prudent. By Theorem~\ref{thm:prudent}, for $\mu$-almost any $x \in X$

$$\lim_{n \rightarrow \infty} {(\E_{\mu}[S_n(x_{:n};F_n(x_{:n})) \mid x_{:n}\OO]-\E_{F_n(x_{:n})}[S_n(x_{:n};F_n(x_{:n}))])} = 0$$

On the other hand, by Lemma~\ref{lmm:update_incomplete}, $(\mu \mid \PO_n)(x_{:n}) \in M \mid x_{:n}$ and hence, since $S_n(x_{:n})$ is $(M \mid x_{:n} \, \epsilon)$-savvy, denoting $r_n:=\DKR^n(F_n(x_{:n}),\, M \mid x_{:n})$: 

$$\E_{\mu}[S_n(x_{:n};F_n(x_{:n})) \mid x_{:n}\OO]-\E_{F_n(x_{:n})}[S_n(x_{:n};F_n(x_{:n}))] \geq \frac{1}{2} (r_{n} - \epsilon) r_n$$

We get

$$\limsup_{n \rightarrow \infty} {(r_{n} - \epsilon) r_n} \leq 0$$

$$\limsup_{n \rightarrow \infty} {r_n} \leq \epsilon$$
\end{proof}

We are finally ready to complete the proof of the main theorem.

\begin{proof}[Proof of Theorem~\ref{thm:main}]

Consider any $M \in \MC$ and a positive integer $k$. By Lemma~\ref{lmm:savvy}, for any $n \in \Nats$, there exists ${S^{Mk}_{n}: \Ob^n \rightarrow \GMO}$ measurable s.t. for all $y \in \Ob^n$, $S^{Mk}_{n}(y)$ is $(M \mid y,\,\frac{1}{k})$-savvy. We fix such a $S^{Mk}_{n}$ for each $M$ and $k$. It is easy to see that the $\DKR^n$-diameter of $\PMO$ is at most 2, therefore $\N{S^{Mk}_{n}(y)} \leq 2$ and $\Sqn{S^{Mk}_{n}}$ is a gambling strategy. By Theorem~\ref{thm:exist_dominant}, there is a forecaster $F^\MC$ that dominates $\PG{S}^{Mk}$ for all $M$ and $k$. By Corollary~\ref{crl:vicinity_convergence}, for any $M \in \MC$, $\mu \in M$, positive integer $k$ and $\mu$-almost any $x \in X$

$$\limsup_{n \rightarrow \infty} {\DKR^n(F^\MC_n(x_{:n}),\,M \mid x_{:n})} \leq \frac{1}{k}$$

It follows that

$$\lim_{n \rightarrow \infty} {\DKR^n(F^\MC_n(x_{:n}),\,M \mid x_{:n})} = 0$$
\end{proof}

\section{Discussion}

We see several natural directions for extending this work.

Theorem~\ref{thm:main} is formulated using the Kantorovich-Rubinstein metric, but instead we could have considered to total variation metric $\DTV$, as in Bayesian merging of opinions\cite{Blackwell_1962}. This would remove the need to renormalize the metrization of $\OO$ and yield a stronger result. However, we currently don't know whether this stronger hypothesis is true.

The present work doesn't analyze any considerations of computational complexity or even computability. It would be very valuable, especially for practical applications, to understand the complexity of forecasters satisfying equation~\ref{eqn:thm_main} given various complexity-theoretic assumptions on $\MC$. In particular, that would entail designing concrete forecasting algorithms of this type, whereas the existence proof in the present work is non-constructive. Also, it would be valuable to analyze the speed of convergence in \ref{eqn:thm_main} and the possibly also the trade-offs between forecaster complexity and speed of convergence.

Finally, we think that the current work may have some bearing on the so-called \enquote{grain of truth} problem (problem 5j in \cite{Hutter_2009}). The problem is, given a system of interacting rational agents, proving their convergence to some reasonable game-theoretic solution concept, e.g. a Nash equilibrium. For a pair of Bayesian agents, this normally requires each agent to lie in the model class $\MC$ of the other agent. However, this requirement is difficult to satisfy in settings that are fairly general, since usually the computational complexity of a Bayesian agent is higher than the complexities of all models in its prior. On the other hand, using our approach, each agent may learn incomplete models satisfied by the other agent that are computationally simpler than a full simulation. This might be sufficient to produce meaningful game-theoretic guarantees.

\appendix

\section{Appendix}

The following variant of the Optional Stopping Theorem appears in \cite{Durrett_2010} as Theorem 5.4.7.

\begin{samepage}
\begin{thm}
\label{thm:optional_stopping}

Let ${\Omega}$ be a probability space, ${\Sqn{\F_n \subseteq 2^\Omega}}$ a filtration of ${\Omega}$, ${\Sqn{X_n: \Omega \rightarrow \Reals}}$ a stochastic process adapted to ${\F}$ and ${M,N: \Omega \rightarrow \Nats \sqcup \{\infty\}}$ stopping times (w.r.t. ${\F}$) s.t. ${M \leq N}$. Assume that ${\Sqn{X_{\min(n,N)}}}$ is a uniformly integrable submartingale. Using Doob's martingale convergence theorem, we can define ${X_N : \Omega \rightarrow \Reals}$ by\footnote{The limit in equation~\ref{eqn:thm_optional_stopping__xn} is converges \emph{almost} surely, which is sufficient for our purpose.}

\begin{equation}
\label{eqn:thm_optional_stopping__xn}
X_N(x):=\lim_{n \rightarrow \infty} X_{\min(n,N)}(x)=\begin{cases}X_{N(x)}(x) \text{ if } N(x) < \infty\\\lim_{n \rightarrow \infty} X_n(x) \text{ if } N(x) = \infty\end{cases}
\end{equation}

We define ${X_M: \Omega \rightarrow \Reals}$ is an analogous way\footnote{This time we can't use Doob's martingale convergence theorem, but whenever ${M(x) = \infty}$ we also have ${N(x) = \infty}$, therefore the limit still almost surely converges.}. We also define the $\sigma$-algebra ${\F_M \subseteq 2^\Omega}$ by

\begin{equation*}
\F_M:=\{A \subseteq X \text{ measurable} \mid \forall n \in \Nats: A \cap M^{-1}(n) \in \F_n\}
\end{equation*}

Then:

\begin{equation*}
\E[X_N \mid \F_M] \geq X_M
\end{equation*}

\end{thm}
\end{samepage}

The following variant of the Michael selection theorem appears in \cite{Yannelis_1983} as Theorem 3.1.

\begin{samepage}
\begin{thm} [Yannelis and Prabhakar]
\label{thm:selection}

Consider $X$ a paracompact Hausdorff topological space and $Y$ a topological vector space. Suppose $B: X \rightarrow 2^Y$ is s.t.

\begin{enumerate}[i.]

\item For each $x \in X$, $B(x) \ne \varnothing$.
\item For each $x \in X$, $B(x)$ is convex.
\item For each $y \in Y$, $\{x \in X \mid y \in B(x)\}$ is open.

\end{enumerate}

Then, there exists $\beta: X \rightarrow Y$ continuous s.t. for all $x \in X$, $\beta(x) \in B(x)$.

\end{thm}
\end{samepage}

\section*{Acknowledgments}

This work was supported by the Machine Intelligence Research Institute in Berkeley, California.

We wish to thank Michael Greinecker for pointing out Theorem~\ref{thm:selection} to us.

%\bibliographystyle{unsrt}
\bibliography{Incomplete_Models}

\end{document}


